<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>GranaData</title>
    <description>Data science from Granada to the world.</description>
    <link>https://granadata.art/</link>
    <atom:link href="https://granadata.art/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 13 Aug 2025 07:53:21 +0000</pubDate>
    <lastBuildDate>Wed, 13 Aug 2025 07:53:21 +0000</lastBuildDate>
    <generator>Jekyll v4.3.2</generator>
    
      <item>
        <title>2024</title>
        <description>&lt;h2 id=&quot;prefacio&quot;&gt;Prefacio&lt;/h2&gt;

&lt;p&gt;Sé que esto no es un libro, y que esta sección debería llamarse introducción y no prefacio. Pero como que este mi blog, pues decido yo mis propias reglas. Lo que vengo a contar a continuación, aunque no muy extenso, sí que es denso. Con el paso de los años voy notando que es imposible acordarse de todo lo que sucede, los detalles en los recuerdos se van erosionando dejando mayormente las emociones que sentimos en aquellos momentos. Una parte del motivo por el que escribo estos párrafos es para poder volver años más tarde, ver qué fue lo que pasó y comprobar si es así cómo lo recuerdo. Otro motivo es usarlo como terapia, y, para qué mentir, también lo hago para alimentar a la IA. Escribir un post así es complicado porque tiene que ser íntimo, pero sin violar la privacidad de nadie. Tiene que tener detalles y al mismo tiempo el hilo central debe quedar claro. Y además de ser descriptivo, también debe intentar hacer reflexionar al lector. Dudo haber conseguido el equilibrio perfecto, pero al menos lo he intentado. Sin duda este es el post al que más horas le he dedicado. Empecé a redactarlo en octubre de 2024 con la intención de terminarlo para la navidad de 2024 y publicarlo como un regalo para mí. Verano de 2025 y aún estoy redactando este prefacio y dándole los últimos retoques. Al final el regalo no será para mí, sino que será de cumpleaños para una persona muy especial para mí. Te invito a ti, lector o lectora, a adentrarte en un pequeño capítulo de mi vida, a ver desde dentro cómo viví aquel año 2024.&lt;/p&gt;

&lt;h1 id=&quot;2024&quot;&gt;2024&lt;/h1&gt;

&lt;p&gt;Siempre recordaré un post de un viejo mentor que decía algo como que en la vida hay momentos de reflexión y momentos de grindear. Enero de 2024 fue sin duda un periodo de mucha reflexión. Las decisiones que marcan el rumbo de nuestras vidas normalmente representan un pequeño porcentaje de nuestra vida. Son decisiones difíciles que determinan los próximos años y que no tienen marcha atrás. Una vez tomadas hay que llegar hasta el final. Un ejemplo de esto es el estudio de una carrera universitaria, no lo vas a dejar el último año así que una vez tomada la decisión la presión de seguir hasta el final es muy grande. Esta decisión yo la tomé en 2018 y determinó mi vida hasta el 2023. Llegado el 2023 me tocaba de nuevo enfrentarme a la vida aunque no estaba preparado. Algunas vidas no vienen con manual de instrucciones así que te toca escribirlo a ti. Muchas vidas sí que vienen con una guía. La sociedad tiene ya escritas las vidas de mucha gente. Desde quien va tachando la lista estándar de coche, casa, pareja e hijos, hasta quien sigue el camino estándar de carrera, máster, doctorado, postdoctorado, profesorado y cátedra. Pero si tu objetivo es inventar algo que se cree imposible entonces la sociedad no sabe qué decirte, y eso complica aún más las decisiones. En 2018 elegí estudiar ciencia de datos porque me acercaba a ese destino. Fue una decisión difícil porque aunque la carrera la tenía clara, el cómo pagarla no tanto. La falta de recursos siempre es un reto añadido. No basta con saber qué quieres sino que tienes que encontrar una manera de lograrlo dentro de tus posibilidades.&lt;/p&gt;

&lt;p&gt;2023 no fue diferente. Había una opción clara pero faltaron los recursos una vez más. Por eso me tomé un periodo “sabático”. Para mí, un periodo “sabático” es aquel en el que solo tengo un trabajo a tiempo completo. Así tengo tiempo para pensar y buscar qué rumbo tomar mientras ahorro para poder ejecutar la próxima decisión. Mi plan al irme a El Ranchito era ese. Tomarme un año “sabático” hasta que llegase 2025 y después ya decidir. Sin embargo, al universo no le gusta que me lo tome con calma por lo que me obligó a tomar una decisión un poquito antes. Los guionistas se pusieron en huelga, la industria del cine entró en recesión y a mí me pusieron en ERTE trabajando al 75%. Así que llegando al final de 2023 tuve que buscar alternativas. Como no quería tomar una decisión dejé que el universo eligiera por mí ya que me había obligado a elegir. Jugué un uno reverse. ¿Cómo se hace eso? Muy sencillo, tomar una decisión no te involucra solo a ti. Si quieres ir a un laboratorio te tienen que aceptar como PhD, si quieres trabajar en una empresa tienes que pasar las entrevistas. Así que lo que yo hice fue diversificar mis resultados. ¿Qué pasa? Que puesto así aún no has obligado al universo a decidir aún. Si tienes tres opciones y te cogen en las tres tienes que elegir igual. Así que lo que hice fue crear un árbol de decisión. Si sucede A hago B, si sucede C hago D y así sucesivamente. De esta forma el universo ya sabe qué voy a hacer y el evento que finalmente acaba sucediendo se puede ver como la elección del universo. Si tengo dos opciones yo determino de antemano cual tiene preferencia, así que si el universo quiere que coja la segunda me tienen que rechazar en la primera. Más que una religión es una filosofía de vida para no amargarte y que las decisiones pesen menos sobre tu espalda. De esta forma ni te duelen los rechazos ni te martirizas por los errores.&lt;/p&gt;

&lt;p&gt;Estas eran las opciones que le di al universo. En primer lugar, el laboratorio de Mihaela: de los más prestigiosos del mundo y con puerta directa a Deep Mind. Claramente la primera opción. El proceso de selección involucraba hacer un artículo en dos semanas y defenderlo como si fuera una tesis frente a sus alumnos. Yo contaba con la recomendación de un viejo amigo suyo y uno de sus estudiantes. Como segunda opción estaba seguir dónde estaba, sin más. Para que eso sucediera en El Ranchito debían quitar el ERTE y subirme el sueldo. Improbable pero no imposible. Esta opción me permitía atrasar más una decisión difícil, así que yo esperaba que no sucediese ya que el universo acostumbra a no ponérmelo fácil. Las otras dos opciones eran dos empresas que simplemente llamaré Alpha y Beta. Ninguna de esas dos empresas me atraía especialmente. Alpha se dedica a optimización del entrenamiento de modelos del lenguaje masivos y Beta se estaba orientando para atacar el mercado de los modelos del lenguaje de consumo. Mi rama favorita de la inteligencia artificial es la visión artificial, no el procesamiento del lenguaje. Lo cual es una putada porque pagan más en procesamiento del lenguaje y se me da mejor. Es por todo esto que el árbol de decisión se limitaba a las condiciones laborales, si no me cogía Mihaela me vendería al mejor postor.&lt;/p&gt;

&lt;p&gt;¿Qué sucedió? Pues nada de eso. El universo me jugó su propio uno reverse. Cuando todo apuntaba a que la decisión estaba tomada surgió una quinta opción. Antes de desvelarla, veamos qué pasó con las opciones iniciales. En la entrevista de Mihaela me acribillaron a preguntas de una forma agobiante y no estuve a la altura. En cierto modo esto habla bien de ella porque ignoró las referencias y evaluó solo mis capacidades, algo que se echa en falta en el sistema español. No me cogieron posiblemente porque mi perfil es muy aplicado –algo que solucionaría en 2025 con un máster en mates puras– y ellos son bastante más teóricos. Aunque podría haber sido mi vía de entrada a Deep Mind seguramente me hubiera quemado. Así que aunque me dolió no conseguirlo en el fondo siento que es mejor así (“No hay mal que por bien no venga”). De hecho creo que hice mal poniéndola como la primera opción. La segunda opción tampoco sucedió. El Ranchito no se recuperó hasta el verano de 2024 y el departamento de Machine Learning no era una prioridad para el grupo Pitch Black, por lo que no merecía la pena seguir mi carrera allí. Ese empleo fue un desvío divertido de mis objetivos, pero tanto yo como las de recursos humanos sabíamos que era temporal. Cuando yo ya había descartado estas dos opciones empezaba el proceso de las otras dos. En Alpha pasé las entrevistas fácilmente porque mis conocimientos se alinean perfectamente con lo que buscaban y en Beta me hicieron una oferta también porque buscaban talento joven para el equipo. Alpha era una empresa grande con la que poco se podía negociar. Beta era una empresa pequeña que tenía más margen de maniobra con las condiciones laborales. En conjunto, si no hubiera habido una quinta opción, habría escogido a Beta.&lt;/p&gt;

&lt;p&gt;¿Cuál era la quinta opción? Pues bien, en medio de todo este caos y de tantos cambios me contactaron unos headhunters para que empezara el proceso de selección de Koh Young Research Spain (KYRS). Normalmente yo a los headhunters los ignoro porque son bastante poco profesionales. No se miran tu perfil y te llaman cuando no encajas, o bien tienen condiciones precarias y lo ocultan. Sin embargo, esta vez fue diferente. El empleo era de visión artificial, lo cual es justo mi perfil. Y las condiciones laborales no las ocultaban, eran transparentes desde el minuto cero. Así que les di una oportunidad. La pega era que tenían el proceso de selección más exigente y largo que he visto nunca, lo que me desmontó todos los planes. El headhunter tuvo que pedirme por favor en varias ocasiones que siguiera con el proceso. La empresa iba ganando puntos cuanto más sabía de ella, y la probabilidad de entrar se me presentó como nula desde un principio. Todo esto dio pie a que me tuviera que enfrentar a una decisión verdaderamente difícil, aunque no la más difícil del año. Al abandonar a Beta, que había apostado por mí de esa manera, yo corría el riesgo de dañar mi reputación. Por contraposición, si aceptaba la oferta de KYRS podía hacer carrera profesional dentro de Granada en el ámbito en el que me había especializado. Los trabajos de visión artificial son muy escasos y requieren de experiencia para conseguir entrar. A la larga, KYRS iba a ser mejor sello en el currículum y el hecho de que tuviera oficinas en Granada me daba la tranquilidad de que no me van a obligar a irme de aquí. Porque teletrabajar siempre viene con letra pequeña, cuando la empresa quiera te puede obligar a ir presencial, si ya estás presencial no te van a mover de ahí. Esto puso a Beta y a KYRS en una balanza que tardó en inclinarse. Finalmente, y no sin remordimientos, opté por entrar en KYRS, decidiendo así el rumbo de mi próximo lustro.&lt;/p&gt;

&lt;p&gt;Seis meses duró el periodo de reflexión. Octubre, noviembre, diciembre, enero, febrero y marzo. Ese fue el plazo desde que se inicia el ERTE hasta que me establezco en Granada. Bastante tiempo para pensar, aunque no el suficiente para decidir. Nunca se tiene suficiente tiempo para decidir, como me volvería a dar cuenta más tarde en agosto de ese mismo año. Aún así, la decisión estaba tomada: haría carrera en KYRS. Empezaría en el equipo de inspección óptica y eventualmente me movería al sector de software médico para finalmente ascender a manager y proponer mis propios proyectos de neurocirujía automatizada. No se sabe si sucederá pero por lo menos el plan está ahí, entre otros planes que se fueron detallando posteriormente.&lt;/p&gt;

&lt;p&gt;Desgraciadamente no todos los planes se cumplen. En ese enero de 2024 también se gestó un plan que se rompería en pedazos meses más tarde. Un 6 de enero conocería a una mujer estupenda (aún pienso que lo es), llamémosla Ana. Por casualidad, el día 5 Ana y yo nos tropezamos en la cabalgata de reyes y al día siguiente tuvimos nuestra primera cita. Hablamos largo y tendido tomando un café al que ella me invitó, y que aún le debo, para despedirnos sin saber cuándo volveríamos a vernos. Pocas veces me he sentido tan a gusto y cómodo conociendo a una persona. Ana me hacía sentir seguro y deseado. Pero duró poco. Yo volvía a Madrid y ella a su ciudad por lo que no quedaba otra que separarse. El resto del año mi tiempo libre lo dedicaba a planear escapadas para intentar volver a verla. Una de ellas fue un viaje que organicé con el único propósito de escaparme en el viaje de vuelta a su ciudad. Movilicé a todos mis amigos solo para tener la oportunidad de acercarme a ella. Fue divertido. Sobretodo cuando nos quedamos atascados en Mérida por la huelga de tractores. A la vuelta mi plan falló porque ella también se había ido de viaje así que me volví solito y desolado. Nada como un buen chuletón para ahogar las penas, me acerqué al casa Pepe y mano de santo. Llevaba ya algún tiempo con curiosidad de ver cómo se sentía comer en un lugar tan franquista. Lo cierto es que es un tanto incómodo, pero tomándoselo con humor se lo pasa uno bien. La gente que va allí son básicamente copias de Mauricio Colmenero. El choque cultural me ayudó a olvidarme de no haber podido ver a Ana ese fin de semana y las preciosas vistas de Despeñaperros hicieron más soportable las seis horas de vuelta a Madrid.&lt;/p&gt;

&lt;p&gt;De Madrid no echaría en falta gran cosa. Me faltó tiempo para mudarme. El único detalle que recuerdo con melancolía son las preparaciones de olimpiadas. Tal es la melancolía que al venir a Granada lo primero que hice fue escribir a Pascual para intentar montarlo en Granada. Pero en ese aspecto Granada no es Madrid y puede que no lo sea nunca, aún así yo aspiro a despertar el talento granadino igualmente. También echaré en falta los manolitos. Cada cierto tiempo llegabas a la oficina y al abrir el ordenador veías un mensaje: “manolitos en la cuarta”. Subías y algún alma caritativa había llevado mini-croissants para todos. Te alegraba el día. Yo llevé tortilla de patatas alguna vez y a la preparación les llevé manolitos también una vez. También le tenía aprecio a una tienda de empanadas argentinas que había cerca de donde vivía. Siempre que veo la marca en otro lugar los compro. Esos pequeños detalles sí los echaré en falta. Todo lo demás de Madrid, por mí puede quedarse en Madrid.&lt;/p&gt;

&lt;p&gt;Con esto no quiero decir que Granada sea perfecta. Mi primer piso fue un desastre. Olía siempre a porro. Una barbaridad. Y no te sentías seguro. Una noche cuando aún no me conocía la zona me desvié y casi acabo en el Almanjáyar. Lo pasé mal. Una pandilla delante, otra en la acera de enfrente, y todos andando hacia ti. Media vuelta y para casa. Seis meses más tarde me mudaría a la otra punta de Granada. El cambio se nota y se agradece. Mientras aún vivía en aquella zona me tocó adaptarme a las circunstancias, entre ellas, el trayecto al trabajo de 40 minutos. Lejos de verlo como un problema lo vi como una oportunidad. 23 libros me leí ese año gracias a esos 80 minutos de viaje diario. Me ayudó a construir un hábito de lectura que aún perdura. Por contra, mantener el hábito del gimnasio fue todo un reto. En Madrid era fácil porque estaba a cinco minutos. En Granada en cambio no hay apenas gimnasios. Tocó adaptarse. Me compré unas pesas, un banco y una barra. No hace falta más. Con eso y disciplina te mantienes en forma fácilmente. O te lesionas por falta de seguridad, por suerte, no sucedió ningún accidente que lamentar.&lt;/p&gt;

&lt;p&gt;Después llegó abril. Dicen que hacen falta dos primaveras para superar un duelo. En abril de 2024 se cumplían ya dos años del accidente de Marc Herault. La primera muerte siempre te deja marcado, las siguientes duelen, pero duelen diferente. La muerte de Marc aún la recuerdo como si fuera ayer. Esa cara del que te da la noticia es inolvidable. Cada vez que la vuelvo a ver no necesito que me digan nada, lo sé al instante. Ese tono de voz apagado es tan distinto de cualquier otra conversación, tan característico. No te queda lugar a duda que lo que te dice es verdad por más que te niegues a aceptarlo. Tu amigo se ha ido, y se ha ido para siempre. Dos años hacían ya de todo eso y se podría decir que, efectivamente, dos primaveras son suficientes. La semana santa de 2024 se sintió como otra cualquiera, el dolor ya no estaba. Solo perduraba el recuerdo alegre de la persona que ya no está. Los que nos quedamos aquí tenemos que seguir, se lo debemos a los que ya no están. Su partida no es excusa para achantarnos aunque igualmente es díficil seguir adelante. Como dice la letra de la canción de Xavibo que había grafiteada cerca de mi piso: “que seguir hacia adelante se sienta como traicionarte te juro que no es justo”.&lt;/p&gt;

&lt;p&gt;Ese mismo abril tuve la oportunidad de participar en los Data Days. Fui a dar un seminario de mi trabajo en El Ranchito y pude coincidir con otros ponentes muy interesantes. La asociación de estudiantes de algún modo había conseguido atraer a trabajadores de DeepMind, de la ONU, de hospitales, y a mí. Me sorprendió el poco éxito que tuvo para la calidad de los ponentes que había. Supongo que la fecha estuvo mal escogida.&lt;/p&gt;

&lt;p&gt;Mayo. En Granada este mes da comienzo con las cruces, una de sus principales fiestas y mi segunda excusa para intentar quedar con Ana. Igual debí haber escuchado al universo. Si algo no sale, es mejor dejarlo estar. Aquellas cruces intenté quedar con ella pero un malentendido nos llevó a no encontrarnos. Posteriormente, ese mismo mes sucedería la noche más surrealista de mi vida hasta el día de hoy. El CEO de Beta venía de viaje a Granada y quería conocerme en persona. Ya de por sí me sorprendía que no me odiara por como jugué con ellos. Pero no solo es que no me odiara sino que aquella noche me invitó a vaciar las reservas de vino de Los Poetas Andaluces. Aunque esta parte podría considerarse normal. Alguien rico que suelta pasta. Esperable. Lo surrealista vendría a consecuencia del vino. La noche fue avanzando y tornándose divertida por momentos. Ojalá no hubiera tenido que trabajar el día siguiente. Quien pudo haber sido mi jefe vino con una compañera suya. Soltera y 40 años. Te puedes imaginar el percal. Una noche para el recuerdo sin duda. El corpus en Granada no decepciona.&lt;/p&gt;

&lt;p&gt;Junio. Feria de Alcalá. Tercer intento de quedar con Ana. A la tercera va la vencida, dicen, pero esta vez no. Esta vez no fue un malentendido, fue cobardía. Los dos estuvimos a menos de cincuenta metros pero no nos juntamos. Ana es de discoteca y mis amigos son de botellón. No me atreví a lanzarme yo solo a los lobos (sus amigas). Un error del que aprendería. Más tarde, en la fiesta de la Abuela en Santana sí que abandonaría a mis amigos para ir a verla. Maravilloso reencuentro que poco duraría. Sus amigas no paraban de alejarla de mí. Lo cual, en retrospectiva, era una señal que tendría que haber escuchado. Esa noche también fue para el recuerdo. Nos tropezamos por la fiesta hasta en tres ocasiones. Bailamos juntos, me robó un beso, hablamos. Balance positivo. El final de nuevo volvió a ser surrealista. Una de sus amigas se puso a hablar de su adicción a la cocaína. No recuerdo si era la que se iba a casar por error o era otra. La cuestión es que a mí me daba igual porque Ana tendía sus brazos en mi pecho. Mi piel aún no se recupera de sus caricias, cómo las añoro. Me faltó tiempo para planear mi próximo intento para quedar con ella: la fiesta de los fuegos en agosto.&lt;/p&gt;

&lt;p&gt;Este plan también falló, pero antes de explicar por qué, hay que situarnos. En julio me mudé más cerca de mi trabajo. También en ese mes despiden a mi padre. Fue un mes de mucho estrés por diversos motivos. Tuve la suerte de poder invitar a mis amigos de Barcelona a pasar un fin de semana estupendo aquí, en Granada. Pero eso no compensó lo que sucedió después. El despido, el estrés, la falta de afecto por su familia y la medicación hicieron de la vida de mi padre un infierno esos días. El 11 agosto celebramos el cumpleaños de mi padre –que es el 13 de agosto– y la cara que mi padre tenía aquel entonces es otra de esas cara que nunca olvidaré. Sus labios sonreían pero sus ojos contaban una historia diferente. Una mirada perdida, cargada de dolor y sin fuerzas. Esos ojos te abrían las puertas de su alma, el alma de quien yo tanto quería, que se mostraba rendida a las circunstancias. Todos tenemos un límite. Un límite al sufrimiento que podemos aguantar, al estrés, al exceso de trabajo, a los abusos, a las injusticias… Y a sus 56 años él llegó al suyo. Ese domingo 11 de agosto le abrazaría sin saber que sería la última vez que sentiría sus brazos rodeando mi cuerpo. La última vez que oiría su voz y sentiría su calor. Dos días más tarde mi padre pondría fin a su sufrimiento. El martes por la mañana recibo una llamada de mi madre para ir a Alcalá a ingresar a mi padre en el hospital. Cuando llego y abro la puerta su cara lo dice todo. La misma cara que dos años atrás vería en mis amigos. Sobraban las palabras. Sobraba todo. Mi mundo se desmoronó por completo en ese mismo instante sin necesidad de que la guardia civil confirmara lo ocurrido. Seis años me costó conseguir encontrar trabajo en Granada para volver a mi tierra. Seis años para volver a tener a mis padres a un tiro de piedra. Seis años alejado de mi cultura. Seis años de estudiar y trabajar. Seis años luchando. Seis años. Mi padre era quien más soñaba con verme volver a mi tierra y por suerte pudo verme conseguir ese logro. Él se fue sabiendo que había hecho un buen trabajo, que ya no lo necesitaba. Llegué a tiempo para acompañarle en sus últimos días. Un martes 13 vino y un martes 13 se fue. Siempre me sentiré afortunado de haber podido compartir parte de mi vida contigo, de aprender de ti. Aunque ya no estés, te tengo presente cada día, en cada decisión. Tu sacrificio no habrá sido en vano, te prometo que mi vida no se para aquí. Te fuiste para protegernos tomando una decisión difícil que yo no supe tomar. Tuviste fuerzas para actuar cuando yo no tenía fuerzas para decidir. Espero que desde el cielo nos veas a mamá y a mí y te alegres de ver que todo salió bien, que hemos salido adelante. Mamá aún te llora y yo aún sigo cabreado contigo. Pero nos salvaste a los dos con tu decisión. Actuaste de muro de contención para evitar que dónde hoy hay un nicho, hubiera tres. Ojalá algún día ser tan fuerte como tú.&lt;/p&gt;

&lt;p&gt;Así que eso fue lo que destrozó mis planes. Los fuegos eran el 15 de agosto, pero después del funeral pocas ganas me quedaban de ver a nadie. Días más tarde tenía organizado un viaje con mis amigos de Barcelona el cual dudé si ir pero al final fui. El viaje me sirvió para despejarme aunque cada noche necesitaba estar a solas para llorar. Aún a día de hoy muchas noches necesito llorar su muerte. De vez en cuando sueño con él, que hablamos todo lo que no pudimos hablar y aunque sé que es un sueño quiero seguir ahí, en el sueño, y al despertarme las lágrimas vuelven a brotar porque es como perderlo otra vez. Por suerte Ana pudo acercarse a darme un abrazo antes del viaje. Tampoco sabía que ese abrazo sería el último. Ana sigue aún viva, pero desde que mi padre falleció nada volvió a ser igual. Meses más tarde por teléfono empezaríamos formalmente una relación que duraría apenas unos días. El valor que me faltó en agosto lo tuve en septiembre. Ella no quería compromiso, quería diversión. Yo ya había planeado una vida con ella pero ella solo planeaba su próxima noche. Podrían ser unos meses divertidos pero no podría formar una familia con ella, así que con todo el dolor del mundo tuve que cortar por lo sano ya que ella no se atrevía.&lt;/p&gt;

&lt;p&gt;Agosto y septiembre fueron meses de tragedias. A finales de agosto otro amigo mío, Guiem, falleció en un accidente de barco. La voz de Pau por teléfono era como la de Bernat años atrás. Cambia tanto el tono al expresar el dolor de una pérdida. Es como hablar con una persona ausente, perdida. En septiembre subí a Barcelona a consolar, o al menos acompañar a los compañeros de Guiem en esos momentos difíciles. Guiem era un chico muy alegre, su partida se notó mucho en el grupo. Esa felicidad se ha evaporado por completo para esos chicos igual que se evaporó para nosotros en 2022. Fue a la vuelta cuando descubrí que mi historia de amor llegaba también a su fin. El fin de semana que subí a Barcelona era la feria de mi pueblo y ella aprovechó para recordar viejos momentos. Se volvió a encontrar con su ex y afloraron sentimientos. Sentimientos prohibidos porque él no quiere nada con ella, pero sentimientos que no puedo ignorar. Al principio pensé que no era tan malo y que podía vivir con ello. Pero después llegué a la conclusión de que no quería ser el segundo plato.&lt;/p&gt;

&lt;p&gt;Tras tanta tragedia, ya pocas fuerzas me quedaban para nada. Pero la vida sigue y hay que seguir con ella. Volví al trabajo y empecé un máster de matemáticas puras. Era mi momento de demostrarme que yo también podía hacer deep learning teórico sin importar que no me cogieran en el laboratorio de Mihaela. Mi TFM lo hice de topología algebraica aplicada a la interpretabilidad y explicabilidad de modelos de deep learning. No descubrí ningún resultado pero aprendí bastante. El objetivo del máster realmente era decidir si quería seguir con el doctorado. Tenía mis dudas y un máster era perfecto para reflexionar durante un año si quería esa vida. Con 18 años uno se embarca en una carrera sin saber el sacrificio que le espera, no quería embarcarme en un doctorado a ciegas también. Antes de comprometerme de nuevo a ese nivel, necesitaba probar una pequeña dosis del sufrimiento que me esperaría. Así pues, tras un año estudiando y trabajando a tiempo completo, llegué a la conclusión de que hacer un doctorado mientras trabajaba no era viable. Esa vida no es para mí. Mihaela hizo el doctorado mientras trabajaba y nos advertía que no recordaba nada de su juventud. Por lo que si quería hacer el doctorado tendría que dejar el trabajo y eso iba en contra de mis planes iniciales. No es que el máster haya sido tiempo perdido porque me ha servido para aclarar mis ideas, algo muy valioso en estos tiempos. A veces necesitas experimentar, solo pensando no puedes tomar según qué decisiones importantes. Antes de empezar el máster me veía muy confiado de que podría trabajar y hacer el doctorado a la vez, pero después del máster, me ha quedado claro que no. Tras los exámenes del primer cuatrimestre me pasé dos semanas enfermo. Vómitos, diárreas, fiebres… El esfuerzo es sobrehumano y tiene un coste que no me apetece pagar para que encima nadie lo valore. Se podría decir por tanto que mi carrera como investigador público se da por terminada, al menos por ahora.&lt;/p&gt;

&lt;p&gt;Con el máster no me quedaría mucho tiempo libre por lo que mi vida social se vería reducida a mínimos. Aún así todavía quedaba en 2024 otra noche para el recuerdo. Sería la noche de Halloween. Surrealista como las demás. Ahí fue cuando descubrí que existen mujeres despreciables que es mejor evitar. Su conducta era más propia de una depredadora sexual que de una mujer borracha. Mis amigos estaban encantados de poder hacer con ella lo que quisieran pero yo no tolero que el desorden se meta en nuestras vidas. Hay ciertos límites morales que creo deben respetarse y ella los superó con creces. Encerrarte en una habitación para intentar liarte con un hombre que tiene novia desde hace seis años es de no tener vergüenza. Más aún cuando él no quería e intentaba escapar de ella. Cruzó límites que no deberían cruzarse. Si dejas que el desorden entre en tu vida al final todo termina desmoronándose. El más mínimo ápice de desorden debe ser erradicado a la mayor brevedad posible. Es muy difícil tener estabilidad y seguridad, y hay que proteger esta tranquilidad a toda costa. Dejé bastante claro que esa mujer no debería volver a estar cerca nuestra, que no la invitaran a nada más. Por exagerada que pareciera mi reacción con respecto a esta chica yo considero que está justificada. Mejor prevenir que curar.&lt;/p&gt;

&lt;p&gt;El último evento reseñable de mi vida este año sucedería en noviembre. Por estas fechas se celebraba la cuarta edición de la datathon fme. Un año antes ya escribí en &lt;a href=&quot;/hack_life&quot; target=&quot;_blank&quot;&gt;otro post&lt;/a&gt; el apego que le tengo a este tipo de eventos. Son para mí un refugio para los estudiantes que no nos dedicamos solo a emborracharnos y que nos gusta aprender. Asistí a esta edición de la datathon para ya decir adiós a mi etapa universitaria y pasar página. Esa sería la última vez que ayudaría a organizar un evento así. Han sido muchos años que he disfrutado muchísimo pero ya se empieza a notar la desconexión con los alumnos. Cuatro años es mucha diferencia a estas edades y eso hace que ya no me sienta tan identificado con ellos. Supongo que es hora de traspasar el relevo a la nueva generación, que demostró estar a la altura. En este mes de noviembre pasaría mi última noche durmiendo en el suelo de la facultad que me ha visto madurar. Vería por última vez a los alumnos apilar vasos de plástico haciendo una torre, tocando el piano, comiendo yogur nocturno o bebiendo monster para activarse. En mi portátil llevo pegado un sticker en recuerdo de estos eventos que tanta vida me han dado. También me entristece pensar que las nuevas generaciones nunca sabrán lo que era una auténtica hackaton. Ya todo se hace con la ayuda de ChatGPT. Lejos quedan los intentos de leerte la documentación de un framework durante horas para finalmente usar un bot de telegram. Ahora el frontend es automático. Esto hace que los proyectos sean más impresionantes que años anteriores, con saltos de calidad notables. Nosotros no éramos tan pros. Se nota como la tecnología avanza y empodera a las nuevas generaciones. Es un orgullo ver de lo que son capaces hoy en día con las nuevas tecnologías, pero también me da nostalgia de ver que nada será cómo antes.&lt;/p&gt;

&lt;p&gt;Estamos llegando al final. Un final digno para un año que marcó el trascurso de mi vida. Un final que me cruzó con dos viejas amistades y cumplió un viejo deseo. Con la llegada del final de año, en navidad, el dolor de la pérdida de mi padre era demasiado grande tanto para mi madre como para mí. Celebrar las navidades en casa no sería agradable. Por eso no lo hicimos. Tomamos la disparatada idea de ir a Barcelona por Navidad, rompiendo así con una larga tradición. Mis padres siempre solían invitarme a comer a algún buen restaurante cuando venían a Barcelona. Hemos estado en el Salamanca, en el Siete Portes, en el Abac, en Can Saia y en otros múltiples locales. Sin embargo, nos quedaba uno por visitar: el Botafumeiro. Hacía algunos años yo había visto a Ibai comer allí y me entraron ganas de ir. Convencí a mis padres para ir pero obvié el detalle de los precios así que tan rápido como entramos nos salimos. Sin embargo, ahora corren otros tiempos y nos podemos permitir celebrar la Navidad ahí. Aprovechando el viaje quedé también con mi grupo de amigos de la universidad para cenar. Lo curioso sería que mientras esperaba para la cena me toparía con Javier, un viejo compañero a quien hacía tiempo que no veía. Y después de cenar, volviendo a casa me tropezaría con Aleix, otro viejo compañero. No había nadie más en la calle a esas horas, pero ahí estaba él. Desde nuestro incidente en primero de carrera nos habíamos distanciado, pero el universo quiso que nos encontráramos justo ahí justo en ese momento. Resulta que él estaba en el mismo proceso que yo al comenzar el año. Tomando decisiones difíciles que marcarían sus próximos cinco años. Un encuentro bastante poético, fue como mirarme a mí un año atrás.&lt;/p&gt;

&lt;p&gt;Como has podido comprobar mi 2024 fue una montaña rusa, plagado de éxitos y tragedias. Un año que ha forjado quién soy ahora, cómo pienso y qué quiero en la vida. 2024 fue un año decisivo que marcó el rumbo de los años posteriores, tanto laboral como personalmente. Que estuvo plagado de aventuras y emociones fuertes que difícilmente podré olvidar. Sin duda, un digno capítulo más que añadir en el libro de mi vida.&lt;/p&gt;
</description>
        <pubDate>Wed, 13 Aug 2025 00:00:00 +0000</pubDate>
        <link>https://granadata.art/2024/</link>
        <guid isPermaLink="true">https://granadata.art/2024/</guid>
        
        
        <category>Philosophy</category>
        
        <category>Stories</category>
        
      </item>
    
      <item>
        <title>Vibe-coding, an informed guide.</title>
        <description>&lt;p&gt;At the beginning of this year 2025, Andrej Karpathy coined the term: &lt;a href=&quot;https://x.com/karpathy/status/1886192184808149383&quot; target=&quot;_blank&quot;&gt;“vibe-coding”&lt;/a&gt;. And since then we have seen the AI discourse become even less serious over time. The typical FOMO discourse (Fear Of Missing Out) continues to say that if you are not using AI you are missing out, that AI will replace us all, that what previously took years now takes hours and so on. I am a big fan of AI and want it to succeed. My side is definitely with &lt;a href=&quot;https://effectiveaccelerationism.substack.com/p/repost-effective-accelerationism&quot; target=&quot;_blank&quot;&gt;e/acc&lt;/a&gt;, but I also want to throw a bit of clarity to all this madness. AI is progress and cannot be stopped, but we must think critically and analyse exactly what is the point in which we found ourselves right now. Vibe-coding is being monetised which means the PRs (Public Relations) are everywhere trying to convince us to buy their products. &lt;a href=&quot;https://replit.com/&quot; target=&quot;_blank&quot;&gt;Replit&lt;/a&gt; is one of those tools that sells itself as a way to build apps just with natural language. It is quite impressive and I have tested and created &lt;a href=&quot;https://preparaomegrx.es/&quot; target=&quot;_blank&quot;&gt;one webpage&lt;/a&gt; entirely with it. Nevertheless, Replit is also responsible for &lt;a href=&quot;https://www.businessinsider.com/replit-ceo-apologizes-ai-coding-tool-delete-company-database-2025-7&quot; target=&quot;_blank&quot;&gt;deleting another company’s codebase&lt;/a&gt;. As I said I want to bring some light to the discourse and this post is going to be an informed analysis on how to do vibe-coding properly, what are its risks and when is it worth it.&lt;/p&gt;

&lt;h2 id=&quot;what-the-data-shows&quot;&gt;What the data shows&lt;/h2&gt;

&lt;p&gt;Let’s start with what we already know. AI is being here for a while and studies are starting to appear. The first study that got to the news was about &lt;a href=&quot;https://www.microsoft.com/en-us/research/wp-content/uploads/2023/12/AI-and-Productivity-Report-First-Edition.pdf&quot; target=&quot;_blank&quot;&gt;Copilot&lt;/a&gt;. They compared the time it took developers to complete tasks with and without Copilot. They measured improvements in the range of 26% and 73%. This study was optimistic since it was coming from Microsoft and it was about one of its products which may raise some eyebrows. But even this optimistic value (73%) is not “what took months takes days”. That is one of the premises that should be banned from the current discourse. Another independent study from Stanford found that improvement to be &lt;a href=&quot;https://www.nber.org/system/files/working_papers/w31161/w31161.pdf&quot; target=&quot;_blank&quot;&gt;14%&lt;/a&gt;, with some productivity metrics going up to a 22.2% improvement, which is a more conservative value. That study started to show that the improvement depended highly on your level of expertise, which is something quite reasonable. Before somebody says that those articles are from 2023, those results have been replicated in &lt;a href=&quot;https://fortegrp.com/insights/ai-coding-assistants&quot; target=&quot;_blank&quot;&gt;2024&lt;/a&gt; (~50%) and &lt;a href=&quot;https://www.pwc.com/gx/en/news-room/press-releases/2025/ai-linked-to-a-fourfold-increase-in-productivity-growth.html&quot; target=&quot;_blank&quot;&gt;2025&lt;/a&gt; (~25%). This clearly means that there is some gain, but there is high variability. The next question is when does this gain happen so that we don’t use AI when it is pointless.&lt;/p&gt;

&lt;p&gt;One study advancing our knowledge in that matter was recently &lt;a href=&quot;https://metr.org/blog/2025-07-10-early-2025-ai-experienced-os-dev-study/&quot; target=&quot;_blank&quot;&gt;published by METR&lt;/a&gt;. This study showed a 19% decrease in productivity in one very specific case: experienced developers of complex projects that knew perfectly all the details of their projects. It also found that developers wrongly believed they were being more productive, something I think is caused by the current discourse. We have been told for a few years that AI is making us more productive so we feel like that even when that is not the case. In the Copilot study developers estimated their gains properly, they felt more productive and were more productive. But here is the opposite. The subjective perception is challenged by the objective measurements. In a curious case of Stigler’s Law, this was not the first study in that direction even though it was the first to reach the public discourse. The &lt;a href=&quot;https://services.google.com/fh/files/misc/2024_final_dora_report.pdf&quot; target=&quot;_blank&quot;&gt;2024 DORA report&lt;/a&gt; reached the conclusion that AI is good for “code quality, documentation, and review processes”. However, it was detrimental for “software delivery performance” (aka teams are slower). Those two reports are all I could find so far using Google and Perplexity that provide negative results, but they provide a clear enough picture into what are the correct and incorrect ways to use AI for software development.&lt;/p&gt;

&lt;h2 id=&quot;what-can-we-do-now&quot;&gt;What can we do now?&lt;/h2&gt;

&lt;p&gt;In a few years I will come to this post and the advice I give is going to be obsolete, but in the current state of affairs what I will describe below are probably good practices when using AI. The main issue with our current systems is the long context. The METR study pointed to complex systems as a place where AI is falling behind, why? AI can perfectly follow orders when you tell it to write a function and has good enough reasoning capabilities for most of the day to day problems, what is happening? The answer is &lt;a href=&quot;https://research.trychroma.com/context-rot&quot; target=&quot;_blank&quot;&gt;long context rot&lt;/a&gt;. Current systems are technically capable of managing millions of tokens which is something my professors at university thought impossible. That context is enough to read entire books and answer any question about any page of the book. Not even a human can do that. Therefore, again, what is happening? What is happening is that the performance is decaying as Lecun &lt;a href=&quot;https://youtu.be/ETZfkkv6V7Y?si=bukWQA2SdbgAGgUR&amp;amp;t=635&quot; target=&quot;_blank&quot;&gt;predicted&lt;/a&gt;, he was initially wrong and correctly criticised but in the end, and for completely unrelated reasons, he seems to be right, once again. Complex systems require a massive amount of knowledge before introducing a new change. Otherwise another feature may stop working, just like in the &lt;a href=&quot;https://www.reddit.com/r/ProgrammerHumor/comments/b61snk/that_famous_function/&quot; target=&quot;_blank&quot;&gt;meme&lt;/a&gt; but for real. Long context have been a problem for a while. Before long context models we had &lt;a href=&quot;https://datos.gob.es/en/blog/rag-retrieval-augmented-generation-key-unlocks-door-precision-language-models&quot; target=&quot;_blank&quot;&gt;RAG&lt;/a&gt; systems that are still being developed today. With the arrival of the agentic models a new protocol was created: &lt;a href=&quot;https://www.anthropic.com/news/model-context-protocol&quot; target=&quot;_blank&quot;&gt;MCP&lt;/a&gt;, which enabled the usage of tools and gave the model access to different contexts. This technology is still in development and will solve the complexity issue in the future but for now, we are stuck with the complexity issue.&lt;/p&gt;

&lt;p&gt;Now that we know the main limitation of current systems, what could be a good workflow to improve productivity? We have a technology that is good in some places and bad in others. The correct approach is neither to discard nor to glorify it. The correct approach is to design a workflow to mitigate risks and increase productivity. This part is a bit technical, so if you just want to know when the usage of this technology is financially justified skip it and go to the next one. The workflow I propose is based on my current experience. I have tried many tools, almost all the LLMs that are in the market, I have worked in production systems, big codebases with no documentation, and also have my own personal projects. Apart from my experience, I also have the habit of discussing software development methodologies with my coworkers. The main concern of senior developers that I have met when using this technology is maintanibility and scalability. Another constraint is that a senior developer must know what every single line of code does, otherwise you just have a functional product that nobody can fix when it breaks. So, how can we reconcile the senior developer job with that of the machine?&lt;/p&gt;

&lt;p&gt;The workflow in itself is quite simple, but the demon is in the details. The workflow that has worked most for me is the following. The first time you arrive at a new codebase you know nothing. It does not matter how many years of experience you have, you start from zero. Therefore, before you are productive you need to get familiar with the codebase. Here, AI is your best ally. Instead of looking at the code and thinking hard what is happening you can ask the bot. The quintessential example is regex. Suppose you find this regex:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;lt;a[^&amp;gt;]*index\s*=\s*[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\']?(\d+)[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\']?[^&amp;gt;]*&amp;gt;(?=.*?&amp;lt;p[^&amp;gt;]*index\s*=\s*[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\']?\1[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\']?[^&amp;gt;]*&amp;gt;)(.*?)&amp;lt;/a&amp;gt;&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A simple question to ChatGPT tells you that it is looking for html a tags with a child p tag that has the same index. Some engineer may have needed to find duplicated html indices to fix some bug and did not have time to document the hacky solution. A few seconds of LLM inference and you can continue understanding the code.&lt;/p&gt;

&lt;p&gt;The next step after you have familiarized yourself with the codebase is to identify patterns. LLMs are matching patterns most of the time, it is their best quality. In day to day work there are many boring tasks that could be easily automatized. One example is generating boilerplate code. LLMs are faster than us at typing. When I learnt to type, to obtain the certificate you needed to type 300 characters per minute, or around 60 words per minute (wps). Some pages show the average is &lt;a href=&quot;https://www.typingpal.com/en/typing-test#:~:text=What%20is%20the%20average%20typing,to%2070%20words%20per%20minute.&quot; target=&quot;_blank&quot;&gt;40 wps&lt;/a&gt; with developers probably in the 70-80 wps side. Evan Chen, which was famous for typing fast is around 150 wps. But that is peanuts compared to LLMs, ChatGPT API throughput is &lt;a href=&quot;https://community.openai.com/t/the-output-speed-of-gpt-4o-in-chatgpt-web-and-app-is-extremely-slow/1123614&quot; target=&quot;_blank&quot;&gt;55 tokens per seconds&lt;/a&gt;, which is 495 wps. And that is one of the slowest LLMs out there. Groq systems are way faster and some even talk about the velocity in &lt;a href=&quot;https://www.reddit.com/r/LocalLLaMA/comments/15nig1k/comment/ksuqaru/?utm_source=share&amp;amp;utm_medium=web3x&amp;amp;utm_name=web3xcss&amp;amp;utm_term=1&amp;amp;utm_content=share_button&quot; target=&quot;_blank&quot;&gt;pages per second&lt;/a&gt;. If you can tell the AI to code a repetitive task that is very long, you can save a lot of time simply because it is faster at typing than you. The difficult part is deciding what processes are suitable for this.&lt;/p&gt;

&lt;p&gt;Once the repetitive patterns are identified the next step is to design skeleton code. Instead of coding everything, you first code the skeleton. Create some main function that calls several other functions and then let the AI implement those other functions. For this task any Cursor-like tool is definitely the best tool, like windsurf. The key is to reduce the complexity. You know the code and you know the solution, split it into simpler tasks and when you reach the level of complexity that current LLMs can handle, you just let them do it.&lt;/p&gt;

&lt;p&gt;Let’s put an example. I recently had a project in which I had to work with OpenCV CUDA. Many of you may be familiar with OpenCV but I doubt that you know all the details of its CUDA version. For instance, &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;cv::Mat&lt;/code&gt; is normally continuous but &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;cv::cuda::GpuMat&lt;/code&gt; is almost never continuous. That piece of knowledge is hidden in a &lt;a href=&quot;https://docs.opencv.org/4.x/d0/d60/classcv_1_1cuda_1_1GpuMat.html&quot; target=&quot;_blank&quot;&gt;note&lt;/a&gt; in the API reference. LLMs kind of helped to find that, for instance. However, documentation ends there. How to access images pixel values? How to pass &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;cv::cuda::GpuMat&lt;/code&gt; to a kernel? That is even more hidden and LLMs are of no help finding that information because it does not exist. You need to go to the code to answer those questions. OpenCV code has a lot of templates and C++ template language is known for being notoriously difficult to interpret. But, after some back and forth with LLMs I finally understood that passing a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;cv::cuda::GpuMat&lt;/code&gt; to a kernel and accessing it was as simple as putting &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;cv::cuda::PtrStep&lt;span class=&quot;nt&quot;&gt;&amp;lt;T&amp;gt;&lt;/span&gt;&lt;/code&gt; in the kernel signature and doing &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;img(y, x)&lt;/code&gt;. This is the first phase, using models to understand and familiarise with the code. Then, I designed a common structure for all the kernels, fixing grid dimensions, fixing the error checking macros and other parts that were going to be repetitive. For instance, after calling a kernel function I needed to add &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;CUDA_CHECK(cudaDeviceSynchronize()); CUDA_CHECK(cudaGetLastError());&lt;/code&gt; for error checking. That is the same everywhere. Repetitive and boring, so if I can make the AI write it for me it is going to save me time. After I designed the skeleton for all the kernels and all the kernel wrappers I finally started using AI to code. With a simple system prompt I put some limits to what the code could be and the best practices that the bot should follow. Whenever the function names were descriptive enough and the task was simple enough the code was working on the first try. Another critical aspect to make all of this work is to do &lt;a href=&quot;https://en.wikipedia.org/wiki/Test-driven_development&quot; target=&quot;_blank&quot;&gt;test driven development&lt;/a&gt;. That makes vibe-coding way more effective.&lt;/p&gt;

&lt;p&gt;After you familiarised yourself with the code, you identified patterns and created the roadmap for the AI, the final step is to review the code. There are parts of the review process that can be automatised also. The DORA report that was one of the critical ones still pointed that AI was positive in this step of the development process. In CUDA code you normally check these things: memory coalescing, thread divergence, bank conflicts in shared memory, occupancy and race conditions. This is anecdotical evidence, but AI once detected a very obscure race condition I had in some code I did myself without AI help. Race conditions are the kind of needle in hay problems AI is good for. Memory coalescing is also a very LLM-friendly task because you just need to check that indices are ordered correctly. That is the kind of mechanical work that AI is good for and humans are not. Automating that leaves room to decide what the kernel should do, which is where my creativity is needed. Apart from that, before merging the code to the main branch, LLMs can perform the first review of your code before other developers get there. It can detect possible deadlocks, memory leakages or simply parts of the code that do not follow the style guidelines. Of course, you need a real human making the final review, but putting an AI in the middle can reduce the workload in the human reviewer.&lt;/p&gt;

&lt;h2 id=&quot;is-it-worth-it&quot;&gt;Is it worth it?&lt;/h2&gt;

&lt;p&gt;Finally let’s put some numbers into the financial side of the equation. We have talked about the performance benefits which range from the optimistic 73% of Microsoft to the more realistic 14% of Stanford. Now let’s talk about the costs. To know how much AI is costing we need to have an estimate of how many tokens per month does a developer consume. There is no conclusive data on this, mainly because the usage is not extended enough. I found this &lt;a href=&quot;https://getdx.com/blog/ai-coding-tools-implementation-cost/#what-teams-actually-pay&quot; target=&quot;_blank&quot;&gt;blogpost&lt;/a&gt; that estimates the consumption to be 1 million tokens per month per developer. That seems like a lot but remember that codebases are big, and the context required to answer the question is what really consumes tokens, so it could be a reasonable estimate. And what is the cost per token of the latest models? As per 27th of July of 2025 the pricing in the OpenAI API is 8$ / 1M tokens for the output of the smartest model. That amounts to a total of 96$ per developer per year. I don’t know if the price has VAT included, but we can round to 150$ to account for that and have a pessimistic estimate. Is that worth it? Well, unless you pay your developers less than 2000$ a year, then yes. Even with the 14% estimate you are better off using AI. However, you need to be careful to not use AI in unneeded places, or you could end up worse.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Software development, when done well, is hard. Current systems have come a long way and will continue to improve. But in the current state of affairs their usage needs to be carefully monitored. There are places where it boosts productivity modestly and there are cases when it can be detrimental. Until AI is good enough to replace us all, we need to be responsible and make decisions based on the data and not on marketing claims.&lt;/p&gt;
</description>
        <pubDate>Sun, 27 Jul 2025 00:00:00 +0000</pubDate>
        <link>https://granadata.art/vibe-coding/</link>
        <guid isPermaLink="true">https://granadata.art/vibe-coding/</guid>
        
        
        <category>AI</category>
        
      </item>
    
      <item>
        <title>GAN optimality proof revisited</title>
        <description>&lt;p&gt;Three years have passed since I published two posts related to the original formulation of the Generative Adversarial Networks (GANs). Three very crazy years in which the state of the art (SOTA) of generative models has surpassed any kind of expectation. Specially in video models that have now passed Tik-Tok quality by of large, they are still below TV quality and, of course, below cinema quality, but it is a lot more than what I predicted back in the days. The new SOTA models are all based on a different formulation from GANs, they use diffusion models. I am not going to write about diffusion models since that topic is already well covered in this &lt;a href=&quot;https://lilianweng.github.io/posts/2021-07-11-diffusion-models/&quot; target=&quot;_blank&quot;&gt;post&lt;/a&gt; together with a continuation for &lt;a href=&quot;https://lilianweng.github.io/posts/2024-04-12-diffusion-video/&quot; target=&quot;_blank&quot;&gt;video diffusion models&lt;/a&gt;. And for those of you who want to have deeper mathematical intuition there is &lt;a href=&quot;https://arxiv.org/abs/2208.11970&quot; target=&quot;_blank&quot;&gt;this wonderful paper&lt;/a&gt; with hundreds of formulas and derivations that gets as deep as you can get into the foundations of diffusion models. However, this post is again about GANs, more concretely, about the optimality proof.&lt;/p&gt;

&lt;p&gt;Three years ago I was not convinced by Goodfellow’s proof of this theorem:&lt;/p&gt;

&lt;div class=&quot;theorem&quot;&gt; The global minimum of $C(G) = \max_{D}V(G,D)$ is reached if and only if $p_{data}\equiv p_g$. Also, that minimum value is $-\log(4)$.&lt;/div&gt;

&lt;p&gt;Just to recap, this theorem is saying that the solution of the min-max problem is reached when we have a perfect generator. And the step that bothered me was in an intermediate proposition:&lt;/p&gt;

&lt;div class=&quot;prop&quot;&gt; If $G$ is fixed, the optimal $D$ is 
&lt;div&gt;$$ D^*(\textbf{x}) = \frac{p_{data}(\textbf{x})}{p_{data}(\textbf{x}) + p_{g}(\textbf{x})} $$&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;This proposition computed the optimal discriminator given the generator. And in the limit it results in a stupid discriminator who always predicts 50-50 probability of being real and fake. I already showed &lt;a href=&quot;/gan_optimality_proof#my-doubts&quot; target=&quot;_blank&quot;&gt;my doubts&lt;/a&gt; with respect to one of the steps regarding the proof of this proposition. In fact, I wrote a &lt;a href=&quot;https://datascience.stackexchange.com/questions/113390/minor-error-in-ian-goodfellows-gan-optimality-proof&quot; target=&quot;_blank&quot;&gt;post&lt;/a&gt; back in 2022 asking if anyone knew of a way to overcome what seemed to be a minor error. Surprisingly, after three years somebody has taken the time to provide a more convincing proof of that tiny step and also highlighted an omission in the Goodfellow paper. So, without further ado, let’s see what I was missing and what Goodfellow was missing.&lt;/p&gt;

&lt;p&gt;First, let’s remember what was the proof. It involves two steps: a change of variable and a maximization problem. The change of variable is a bit technical and you can give a look to an sketch of the details and the theorems involved in &lt;a href=&quot;/gan_optimality_proof#prop&quot; target=&quot;_blank&quot;&gt;my previous post&lt;/a&gt;. It reduced the problem to finding the maximum of this integral&lt;/p&gt;

&lt;div&gt;$$ \int_{\textbf{x}} p_{data}(\textbf{x})\log(D(\textbf{x})) + p_g(\textbf{x})\log(1-D(\textbf{x})) d\textbf{x} $$&lt;/div&gt;

&lt;p&gt;The original argument to maximize this integral read, quote: “For any $(a,b) \in \mathbb{R} - {(0,0)}$, the function $y \rightarrow a \log (y) + b \log (1-y)$ achieves its maximum in $[0,1]$ at $\frac{a}{a+b}$.” That argument for me was insufficiently explained, but it is correct (for the most part). The argument is basically constructing a function that at each point is the maximum; therefore, when integrating, the result is the maximum possible. I initially understood the argument as simply optimizing the integrand which seemed incorrect to me because $(a,b)$ here are not constant. But later on, Graham Pulford pointed out that this is calculus of variations. So here it goes what I think is a more rigorous rewrite of that step. We define the lagrangian to be&lt;/p&gt;

&lt;div&gt;$$ \mathcal{L}(\textbf{x}, D, D') = p_{data}(\textbf{x})\log(D(\textbf{x})) + p_g(\textbf{x})\log(1-D(\textbf{x})) $$&lt;/div&gt;

&lt;p&gt;Thus, the optimum (if it exists) must satisfy the Euler-Lagrange equations:&lt;/p&gt;

&lt;div&gt;$$ \frac{\partial \mathcal{L}}{\partial D} - \frac{d}{d\textbf{x}}\frac{\partial \mathcal{L}}{\partial D'} = 0 $$&lt;/div&gt;

&lt;p&gt;It looks like I am treating multivariable as single variable but I am just using this notation for simplicity: $\frac{d}{d\textbf{x}} = \sum_i \frac{\partial}{\partial x_i}$. The Euler-Lagrange equations is only one equation in fact because there is no derivative in the lagrangian. Therefore we just need to solve for $\frac{\partial \mathcal{L}}{\partial D} = 0$. With some patience that leads to the desired result:&lt;/p&gt;

&lt;div&gt;$$ 
\begin{align*}
&amp;amp;\frac{\partial \mathcal{L}}{\partial D} = \frac{p_{data}(\textbf{x})}{D} - \frac{p_g(\textbf{x})}{1-D} = 0\\
\Rightarrow&amp;amp; \frac{p_{data}(\textbf{x})}{p_g(\textbf{x})} = \frac{D}{1-D} = \frac{1}{1-D}-1\\
\Rightarrow&amp;amp; \frac{p_{data}(\textbf{x}) + p_g(\textbf{x})}{p_g(\textbf{x})} = \frac{1}{1-D}\\
\Rightarrow&amp;amp; D = \frac{p_{data}(\textbf{x})}{p_{data}(\textbf{x}) + p_g(\textbf{x})}
\end{align*}
$$&lt;/div&gt;

&lt;p&gt;But there is a catch. This argument only works for sufficiently smooth lagrangians which is why intuitive arguments should be made rigorous. Taking the optimum at each point and integrating only returns the functional optimum if the functions are not pathologic, which in this context means twice differentiable. To solve the Euler-Lagrange you only need the integrand to be once differentiable, but to prove it is a maximum you need to look into the second derivative and see it is negative, which is, in fact, the case:&lt;/p&gt;

&lt;div&gt;
$$ \frac{\partial^2 \mathcal{L}}{\partial D^2} = -\left(\frac{p_{data}(\textbf{x})}{D} + \frac{p_g(\textbf{x})}{1-D}\right) &amp;lt; 0 $$
&lt;/div&gt;

&lt;p&gt;And what happens if you do not have a sufficiently smooth integrand? In that case you no longer have such a simple way to find the optimal discriminator. But that surely only happens in the mind of the perturbed mathematicians, right? Wrong. That assumption can be broken very easily. &lt;a href=&quot;https://ieeexplore.ieee.org/document/9641798&quot; target=&quot;_blank&quot;&gt;Graham Pulford&lt;/a&gt; showed that having $\dim(\textbf{z}) &amp;lt; \dim(\textbf{x})$ is enough to break the smoothness of the lagrangian. This comes from the first step of the proof: the change of variable. When reducing the dimensionality of a probability distribution function the behaviour can be pathological, breaking the smoothness. In that article I linked, he constructed several concrete examples showing such pathological behaviour. That same author &lt;a href=&quot;https://ieeexplore.ieee.org/abstract/document/11030454&quot; target=&quot;_blank&quot;&gt;went a step further&lt;/a&gt; and constructed a discriminator that was optimal but was nowhere equal to the $1/2$ that Goodfellow promised. Curiously enough, that discriminator produces $1$ almost everywhere and $0$ in a set of measure zero, which means it is also a stupid discriminator that is overconfident in saying that everything is fake. As expected, answering one question creates new ones. In this case I am left with the doubt of whether or not the optimal discriminator is always independent with respect to the generator. Maybe in another three years that is also solved?&lt;/p&gt;

&lt;p&gt;Apart from the theoretical insights, all of these new results bring more light to the practical side of the GANs. Training a GAN was always an unstable process that required many tweaks to make it work. We now know the reason for that instability. The initial algorithm for training GANs was an iterative process that tuned discriminator and generator in alternate processes. The tuning method for the discriminator involved that formula that appeared in the proposition we mentioned before. That formula we now know has no guarantees of being always correct. Since the issue was with the smoothness, many tweaks for making the learning more stable did that in different ways. Either with regularization or controlling the rate of change. But, in the end, every method was just a patch to a fundamental flaw in the formulation. This may explain why everybody has moved to diffusion models. Their formulation is more robust and its training is better understood.&lt;/p&gt;
</description>
        <pubDate>Sun, 20 Jul 2025 00:00:00 +0000</pubDate>
        <link>https://granadata.art/gan-optimality-revisited/</link>
        <guid isPermaLink="true">https://granadata.art/gan-optimality-revisited/</guid>
        
        
        <category>GAN</category>
        
        <category>Theory</category>
        
        <category>unsupervised learning</category>
        
        <category>Deep Learning</category>
        
      </item>
    
      <item>
        <title>Pensar rápido, pensar despacio</title>
        <description>&lt;p&gt;Uno de enero, todo el mundo se propone cambiar algún hábito. Pocos los consiguen. En mi caso no me propuse nada pero surgió una idea que posteriormente se transformó en costumbre. Ese mismo día le pregunté a un amigo mío que me recomendara un libro para leer. Llevo años sin leer en serio y como no sabía por dónde empezar dejé que esa decisión la tomaran por mi. La recomendación fue “Momentos estelares de la humanidad” de Stefan Zweig. Tardé más de un mes en comprarlo y otro mes en leerlo. Cuando acabé llegué a la conclusión de que no era de mi estilo. No obstante, volví a probar suerte. La siguiente recomendación fue “El señor de las moscas” de William Golding. Este sí fue de mi agrado. Y a partir de ahí, surgió un hábito. Este año estoy viajando a través de los gustos literarios de mis amigos y amigas. Libro tras libro. Leer el libro favorito de alguien te revela mucho sobre su forma de ser. Y también te abre la mente a lecturas que de normal rechazarías. Requiere disciplina. De momento llevo 9 ejemplares añadidos a mi colección siendo el último del que vengo a hablar hoy.&lt;/p&gt;

&lt;p&gt;El libro titulado “Pensar rápido, pensar despacio” fue escrito por Daniel Kahneman, un psicólogo con un premio Nobel de economía. El autor reúne en esas 672 páginas toda su carrera profesional. Es una colección extensa de experimentos obtenida tras varias décadas de trabajo. Un libro de ensayo que expone una tesis de una forma muy similar a como Susan Cain expresaba la suya en “El poder de los introvertidos”. Varios experimentos me he encontrado que se hallaban en ambos libros. Sin embargo, cada autor los ve con sus propias gafas. Yo también he sacado mis propias conclusiones, pero creo que es más interesante exponer los experimentos desprovistos de connotaciones y que cada cual aprenda lo que quiera de ellos. Además de los experimentos también explicaré algunos conceptos que trata el libro y añadiré algunos detalles que me parecen relevantes.&lt;/p&gt;

&lt;p&gt;Antes de seguir, vea el siguiente vídeo a pantalla completa:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;
    &lt;video class=&quot;&quot; controls=&quot;&quot;&gt;
        &lt;source src=&quot;/assets/video/test.mp4&quot; type=&quot;video/mp4&quot; /&gt;
        Your browser does not support the video tag.
    &lt;/video&gt;
&lt;/p&gt;

&lt;p&gt;¿Vió al gorila? La mitad de las personas no lo ven. Cuando focalizas tu atención en una tarea, olvidas las demás. Ese era el primer experimento llamativo del libro. Casi todos los experimentos tienen un efecto similar. Inicialmente nada parece sorprender. Todo es intuitivo y obvio. Pero cuando te explican el trasfondo te das cuenta de lo sesgada que es la percepción humana, hasta el punto de no ver un gorila enorme. Posiblemente algunos de ustedes sí que vieran el gorila. Esto no es una ciencia natural, es una ciencia social. Por eso cada experimento se debe hacer con una muestra poblacional representativa. En este caso Christopher Cabris y Daniel Simons lo probaron con personas de distintas edades, culturas, educación y género. La conclusión es que el efecto es inequívocamente válido para toda la población mundial. La mitad de las personas no ven al gorila y la otra mitad sí. Parece imposible no verlo, ¿verdad? Pues igual de sorprendentes son muchos de los experimentos y resultados que expondré a continuación.&lt;/p&gt;

&lt;h2 id=&quot;heurística-de-la-disponibilidad&quot;&gt;Heurística de la disponibilidad&lt;/h2&gt;

&lt;p&gt;Propóngase usted dar 20 ejemplos de situaciones en las que se mostró con un carácter firme frente a la adversidad en el que demostraba su capacidad ejecutiva.&lt;/p&gt;

&lt;p&gt;¿Ya? ¿Se siente más o menos seguro de sí mismo? En eso consistía este otro &lt;a href=&quot;https://psycnet.apa.org/record/1991-33131-001&quot; target=&quot;_blank&quot;&gt;experimento&lt;/a&gt;. Muchas de las personas entrevistadas se sentían menos seguras si se les había pedido muchos ejemplos y en cambio, las que se les preguntó menos ejemplos se sentían más seguras. Un curioso resultado. Si doy más ejemplos de seguridad me siento menos seguro. A este efecto también se le conoce como sesgo de disponibilidad. La inseguridad viene de que los últimos ejemplos cuestan más de recordar que los primeros. Cuando nos cuesta encontrar argumentos nuestro cerebro genera dudas sobre esa postura. Este efecto se puede eliminar si a esa dificultad cognitiva se le da una explicación, como por ejemplo decirle a los participantes del estudio que les va a costar más encontrar ejemplos por el ruido de la clase de al lado.&lt;/p&gt;

&lt;h2 id=&quot;efecto-de-mera-exposición&quot;&gt;Efecto de mera exposición&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://psycnet.apa.org/record/1968-12019-001&quot; target=&quot;_blank&quot;&gt;Zajonc&lt;/a&gt; decidió publicar palabras inventadas en el periódico durante varias semanas. Después, al preguntarle a las personas qué palabras les gustaban más, las que habían visto en el periódico recibieron mayor puntuación. Todo ello a pesar de que son palabras sin significado ninguno.&lt;/p&gt;

&lt;p&gt;Igual de llamativo es &lt;a href=&quot;https://www.science.org/doi/10.1126/science.1110589&quot; target=&quot;_blank&quot;&gt;este otro resultado&lt;/a&gt; en el que Todorov conseguía predecir el resultado de las elecciones basándose en las puntuaciones que los participantes del estudio daban a las caras de los políticos. Es remarcable porque los participantes evaluaban la competencia de la persona basándose solo en la cara y siendo estas caras de políticos de países arbitrarios sin relación alguna con los participantes. Es como si Tezanos se va a Australia y hace encuestas solo enseñando las caras de los políticos españoles a los australianos. Posiblemente acertaría más.&lt;/p&gt;

&lt;p&gt;Y en la misma línea hay &lt;a href=&quot;https://dspace.mit.edu/handle/1721.1/96161&quot; target=&quot;_blank&quot;&gt;otro artículo&lt;/a&gt; que muestra cómo los políticos guapos que aparecen más en televisión obtienen mejores resultados, simplemente por aparecer más en televisión. La mera exposición los hace recibir una mayor aprobación.&lt;/p&gt;

&lt;h2 id=&quot;efecto-halo&quot;&gt;Efecto halo&lt;/h2&gt;

&lt;p&gt;El autor describe el concepto de efecto halo como el hecho de asociar a una persona solo atributos positivos o solo atributos negativos. O como los autores también lo describen: “What You See Is All There Is”. Evaluamos el todo por una parte. Prueba de ello quedó reflejado en &lt;a href=&quot;https://psycnet.apa.org/record/1946-04654-001&quot; target=&quot;_blank&quot;&gt;el estudio de Solomon Asch&lt;/a&gt;. En él se preguntaba la opinión de dos personas:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Alan: inteligente-diligente-impulsivo-crítico-testarudo-envidioso

Ben: envidioso-testarudo-crítico-impulsivo-diligente-inteligente
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seguramente te hayas percatado de que son la misma descripción. Pero recibieron valoraciones dispares, obteniendo Alan puntuaciones más favorables que Ben. Los adjetivos del principio terminan acaparando la atención y cogen más peso que los del final. Ese es el efecto halo. Básicamente es formarse un prejuicio e ignorar la información que lo contradiga. También hay que notar que si se evalúan por separado o conjuntamente la visión cambia. Cuando evalúas los dos perfiles conjuntamente es más fácil darse cuenta de su equivalencia. Esta diferencia entre evaluar conjuntamente y por separado quedó plasmada por &lt;a href=&quot;https://citeseerx.ist.psu.edu/document?repid=rep1&amp;amp;type=pdf&amp;amp;doi=3a9bdf026c5e6bbea2cd9f715c430984cecb10da&quot; target=&quot;_blank&quot;&gt;Christopher Hsee&lt;/a&gt;. En su experimento preguntó a varias personas que evaluaran dos vajillas. Una tenía 24 unidades en perfecto estado y otra tenía 40 unidades con 9 de ellas rotas. Cuando veían las dos conjuntamente se valuaban a un mayor precio la de 40 porque era exactamente igual que la de 24 pero con más piezas. Sin embargo, cuando se valoraban por separado la de 40 acababa recibiendo un menor precio debido al hecho de contener platos rotos. Un efecto que Hsee denominó como “menos es más”. El propio Kahneman realizó &lt;a href=&quot;https://psycnet.apa.org/record/1984-03110-001&quot; target=&quot;_blank&quot;&gt;un experimento similar&lt;/a&gt;. En este caso menos es más hace referencia a probabilidades. Es una proposición matemática el que la probabilidad de la intersección de dos eventos es igual o menor que la de cada evento por separado. En lenguaje llano esto nos viene a decir que es más probable encontrar un gato en la calle que encontrar un gato en la calle que a la vez sea blanco. Cada propiedad adicional reduce la probabilidad de que suceda. Pero a ojos de la gente esto no siempre es así. El experimento comenzaba describiendo a una mujer:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Linda tiene treinta y un años, es soltera, franca y muy brillante. Se especializó en filosofía. De estudiante le preocupaban mucho los asuntos de discriminación y justicia social, y también participó en manifestaciones antinucleares.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Y posteriormente se pedía evaluar las probabilidades de los siguiente hechos:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Linda es profesora de primaria.&lt;/li&gt;
  &lt;li&gt;Linda trabaja en una librería y recibe clases de yoga.&lt;/li&gt;
  &lt;li&gt;Linda milita en el movimiento feminista.&lt;/li&gt;
  &lt;li&gt;Linda presta asistencia social en psiquiatría.&lt;/li&gt;
  &lt;li&gt;Linda es un miembro de la Liga de Mujeres Votantes.&lt;/li&gt;
  &lt;li&gt;Linda es cajera de un banco.&lt;/li&gt;
  &lt;li&gt;Linda es corredora de seguros.&lt;/li&gt;
  &lt;li&gt;Linda es cajera y activista del movimiento feminista.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;De esta lista los eventos de interés son “cajera de banco” y “cajera de banco feminista”. Las personas dieron menor probabilidad a cajera de banco. Sin embargo, toda cajera de banco feminista es a su vez cajera. Luego la probabilidad es estrictamente menor. Menos es más.&lt;/p&gt;

&lt;h2 id=&quot;regresión-a-la-media&quot;&gt;Regresión a la media&lt;/h2&gt;

&lt;p&gt;Esto no es un experimento per se sino más bien un hecho estadístico igualmente remarcable. Considérese la distribución de probabilidad (PDF) de una gaussiana:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/gaussian.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Supongamos que muestreamos a partir de dicha PDF dos veces de forma independiente. Y yo ahora le digo que la primera ha salido con un valor muy a la derecha. ¿Qué es más probable? ¿Que la segunda esté a la izquierda o a la derecha de la primera? Si observamos el siguiente gráfico se ve que claramente es más probable que esté a la izquierda. El área bajo la curva es mayor. La probabilidad de que quede en el área sombreada es superior a un medio como se ve en la función de la derecha.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/gaussian2.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esto es el efecto de regresión a la media. Un ejemplo más palpable sería la inteligencia de los hijos. Si tus hijos son extraordinariamente avispados, es muy probable que tus nietos lo sean menos. Y al revés también. O en el caso del autor, un soldado que resolvía una prueba de forma excelente solía obtener un peor resultado en la siguiente. Y quién lo hacía muy mal, lo solía hacer mejor después. Esto sucede cuando dos variables se hallan poco correlacionadas, como en los ejemplos anteriormente expuestos.&lt;/p&gt;

&lt;h2 id=&quot;fallos-médicos&quot;&gt;Fallos médicos&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://doi.org/10.1016/j.amjmed.2008.01.001&quot; target=&quot;_blank&quot;&gt;Un análisis&lt;/a&gt; sobre errores médicos en la UCI concluyó que “los médicos que creían estar ‘completamente seguros’ de su diagnóstico ante mortem estaban equivocados en el 40 por ciento de los casos”. De forma completamente independiente, en el libro también se relata &lt;a href=&quot;https://pure.mpg.de/rest/items/item_2225074_9/component/file_3569491/content&quot; target=&quot;_blank&quot;&gt;la historia&lt;/a&gt; de un médico del siglo XX que siempre acertaba en sus diagnósticos de tifus pero resultó que era porque tocaba las lenguas de los pacientes sin lavarse causando la propia enfermedad. Posteriormente también &lt;a href=&quot;https://doi.org/10.1023/a:1005595519944&quot; target=&quot;_blank&quot;&gt;se muestra&lt;/a&gt; como los psiquiátras evaluaban de forma diferente el riesgo de violencia de un paciente en función de si la información se le presentaba en formato frecuencial o absoluto, es decir, quien leía que hay un 10% de probabilidades de violencia se sentía menos reacio a liberar a un paciente que quien leía que 10 de cada 100 pacientes similares son violentos. En concreto, el 41% denegaron el alta al paciente en el primer caso y el 21% en el segundo caso.&lt;/p&gt;

&lt;h2 id=&quot;efecto-espectador&quot;&gt;Efecto espectador&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://psycnet.apa.org/record/1968-08862-001&quot; target=&quot;_blank&quot;&gt;Este&lt;/a&gt; es posiblemente de los estudios más antiguos del libro. John M. Darley realizó el siguiente experimento un tanto macabro. Había diversos participantes cada uno en una salita aislada con un micrófono en su interior. Cada persona solo podía hablar cuando era su turno. En una de las intervenciones el interlocutor mencionaba su inclinación a sufrir ataques de ansiedad. Poco después, el actor que interpretaba ese papel fingía sufrir uno de esos ataques y pedía ayuda a la vez que parecía ahogarse. En medio de su sufrimiento su micrófono se corta y se da pie al siguiente participante a hablar. ¿Cuántos creéis que pidieron ayuda? De los 15 participantes, 4 pidieron ayuda inmediatamente, seis no salieron de la cabina y cinco salieron algo después de que el micrófono se cortara. Este efecto muestra que cuando hay otras personas alrededor, nos sentimos menos proclives a actuar frente a emergencias.&lt;/p&gt;

&lt;p&gt;Ahora ya sabe que una primera estimación de la probabilidad de ayuda es del 27% en casos de emergencia (4 de 15). Dado ese conocimiento, si se le presentasen otros 15 individuos y se le pidiera que identificara quién saldrá a ayudar y quién no, ¿acertaría el porcentaje? Presentado así, lo más lógico seguramente sea predecir de nuevo que solo 4 irán raudos a salvar al afectado. Pero &lt;a href=&quot;https://psycnet.apa.org/record/1976-04569-001&quot; target=&quot;_blank&quot;&gt;otro estudio&lt;/a&gt; mostró que conocer la tasa base no afecta en las predicciones de la población. Incluso aún sabiendo que un evento tiene una determinada probabilidad, si nuestra creencia es contraria a ese hecho, las predicciones se alejarán de esa probabilidad. Algo similar sucede con la inversión en bolsa. El consejo financiero más básico es aguantar tu posición y esperar a que el mercado responda. Históricamente el precio de las acciones ha subido alrededor de un 10%. Es solo cuestión de esperar. Pero muchas personas creen tener información privilegiada del mercado que les permitirá sacar ventaja de las fluctuaciones diarias. Esta ilusión de sagacidad es lo que lleva a que los inversores individuales pierdan sistemáticamente contra las instituciones financieras. Estimándose que un &lt;a href=&quot;https://faculty.haas.berkeley.edu/odean/papers%20current%20versions/justhowmuchdoindividualinvestorslose_rfs_2009.pdf&quot; target=&quot;_blank&quot;&gt;2.2% del PIB&lt;/a&gt; se transfiere de inversores individiduales que realizan una compraventa frecuente hacia las instituciones financieras. De igual manera, también &lt;a href=&quot;https://www.wbs.ac.uk/news/are-women-better-investors-than-men/&quot; target=&quot;_blank&quot;&gt;se ha observado&lt;/a&gt; que las mujeres son consistemente mejores inversoras que los hombres.&lt;/p&gt;

&lt;h2 id=&quot;entornos-de-poca-validez&quot;&gt;Entornos de poca validez&lt;/h2&gt;

&lt;p&gt;La ilusión de sagacidad antes presentada en gran parte se debe a intentar predecir algo que es impredecible. En eso consiste un entorno de poca validez. Para poder llegar a ser un experto no es solo suficiente con dedicar 10.000 horas de tu tiempo. También tienes que recibir un feedback consistente y estadísticamente significativo. El azar puede llegar a alterar la percepción de la habilidad. Uno de los ejemplos que se suele exponer es el de los radiólogos. Es una disciplina en la cual el feedback es tardío y en muchos casos no es concluyente al 100%. Esto lleva a que ser experto en radiología sea más difícil que serlo en otras disciplinas donde hay una respuesta inmediata y clara respecto a tus acciones. Similar a radiología es la histopatología. Durante mi colaboración con el Vall d’Hebrón era perceptible la complicación del asunto. Determinar si una célula es o no cancerígena tiene un cierto componente aleatorio. Kahneman explicaba también que determinar la valía de un soldado en pos de un examen psicológico dependía más del azar de lo que le gustaría.&lt;/p&gt;

&lt;p&gt;Afortunadamente hay soluciones. Cuando se necesita un determinado juicio de valor es posible conseguir un resultado más objetivo. El autor del libro explicaba que lo que él hizo fue separar la prueba en diversas subpruebas de menor alcance. Cada una mucho más específica que la evaluación general. A su vez, el resultado de cada entrevista se asignaba a un profesional distinto el cual solo daba una puntuación subjetiva de su percepción de ese aspecto. Posteriormente, todas las puntuaciones se combinaban en un único resultado. De esta forma se consigue domar un poco más la intuición. Este sistema de evaluación por tokens también lo desplegó un antiguo profesor mío de literatura para evaluar debates. Fernando Fedriani hizo su &lt;a href=&quot;https://dialnet.unirioja.es/servlet/tesis?codigo=77759&quot; target=&quot;_blank&quot;&gt;tesis doctoral&lt;/a&gt; en un sistema de evaluación del debate. De nuevo, mediante la creación de tokens se consigue que el evaluador reduzca sus sesgos a unos atributos concretos. Al promediar los resultados los efectos azarosos quedan reducidos, resultando en un método más objetivo.&lt;/p&gt;

&lt;p&gt;En el ámbito médico también es posible dotar a los profesionales de herramientas para conseguir mejores diagnósticos. Sin embargo, como describe el autor del libro, los especialistas son reticentes a aceptar esos cambios. A pesar del cuerpo de evidencia creciente, el statu quo tiene bastante peso.&lt;/p&gt;

&lt;h2 id=&quot;pre-mortem&quot;&gt;Pre mortem&lt;/h2&gt;

&lt;p&gt;Una técnica exitosa para mitigar los efectos de los sesgos humanos es lo que el autor denomina como el pre mortem. Es un ejercicio simple. Considere este escenario. Es un ejecutivo de una empresa que está planeando un proyecto a largo plazo. Ha hecho la investigación pertinente y sabe los riesgos y posibles beneficios. Sin embargo, es posible que haya sobrestimado la posibildad de éxito. Así que la solución es la siguiente. Imagínese que ha pasado un año y el proyecto ha fracasado estrepitosamente, ¿por qué? Intente dar una explicación de qué ha salido mal. Así es como Kahneman descubrió que los ejecutivos conseguían estimar con mayor precisión los verdaderos riesgos así como los plazos necesarios para llevar a cabo sus proyectos.&lt;/p&gt;

&lt;h2 id=&quot;ley-weber-fechner&quot;&gt;Ley Weber-Fechner&lt;/h2&gt;

&lt;p&gt;Esta ley psicofísica es una formulación matemática de la percepción humana a los estímulos. Fechner descubrió que la percepción de un estímulo escala acorde al logaritmo de la magnitud del mismo. De manera parecida sucede en la percepción de la utilidad de dinero. De forma aproximada Kahneman nos muestra el siguiente gráfico:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/utility.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y nos explica que para quien es rico 200€ valen menos que para quien es pobre. Nada remarcable. De igual manera perder 200€ te duele más si solo tienes 200€ que si tienes 200.000€. Y parece evidente también que perder duele con más fuerza que ganar. Son hipótesis sencillas y bastante aceptables. Pero las conclusiones que se deducen de ellas veremos que no lo son tanto. Primero a través de dos preguntas y luego más rigurosamente con el teorema de Rabin. Empecemos por la primera pregunta, tiene que que escoger entre dos opciones:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;25% probabilidad de ganar 240€ y 75% probabilidad de perder 760€.&lt;/li&gt;
  &lt;li&gt;25% probabilidad de ganar 250€ y 75% probabilidad de perder 750€.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;La segunda opción es claramente mejor y así lo decidieron todos los participantes del estudio. Ahora se presentan otras dos elecciones diferentes. Primero elija entre:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;100% probabilidad de ganar 240€.&lt;/li&gt;
  &lt;li&gt;25% probabilidad de ganar 1000€ y 75% probabilidad de no ganar nada.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Y luego elija entre:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;100% probabilidad de perder 750€.&lt;/li&gt;
  &lt;li&gt;75% probabilidad de perder 1000€ y 25% probabilidad de no perder nada.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si es como la mayoría de participantes del artículo del apéndice B del libro seguramente tenga aversión al riesgo en las ganancias apostando por la cantidad segura e inclinación al riesgo en la pérdidas apostando por la posibilidad de no perder nada. De igual manera en la primera pregunta habrá escogido la opción dos sin dudarlo. Pues ahora viene la contradicción. Si escogió la opción segura de ganar 240€ y la incierta de no perder nada, eso es equivalente a la opción 1 de la primera pregunta que claramente rechazó. Un mismo problema enmarcado de dos formas distintas lleva a decisiones opuestas.&lt;/p&gt;

&lt;p&gt;Kahneman trabajó durante mucho tiempo con un compañero llamado Amos. Amos comprobó que este efecto marco se podía usar para manipular las decisiones de los expertos en salud pública. En una conferencia sobre lo que denominaban enfermedad asiática a la mitad de los asistentes se les presentó una versión que ilustraba una posible solución junto con las posible vidas salvadas. A la otra mitad les mostró el programa pero les explicó cuántas personas morirían. En esencia es lo mismo, si de 1000 personas 100 fallecen, eso implica que 900 sobreviven. No cambia en absoluto la eficacia del tratamiento el exponerlo en términos de fallecimientos que de salvaciones. Pero los funcionarios que asistieron sí que tomaron decisiones diferentes en función de la versión escuchada.&lt;/p&gt;

&lt;p&gt;Otro caso peculiar es sobre las deducciones fiscales por hijos. Thomas C. Schelling explicaba en su libro Choices and Consequences uno de estos efectos marco. En él presentaba dos escenario que en principio son equivalentes pero no lo parecen. El primer escenario consistía en una posible ley sobre deducciones fiscales por hijos. La pregunta era como sigue:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;¿Debe la deducción fiscal por hijo ser mayor para el rico que para el pobre?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sus alumnos contestaron que no. Era injusto dar mayor ventaja al rico. Ahora veamos el segundo escenario. Supongamos que no existe ninguna deducción fiscal por tener hijos. Pero que en cambio existe una penalización para quien no los tiene. Dicha penalización vendría dada por un impuesto adicional para quien no tenga hijos. Ahora la pregunta es:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;¿Debe el pobre sin hijos pagar el mismo impuesto que el rico sin hijos?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;De nuevo respondieron que no. Quien tiene más paga más. Es injusto hacer pagar al pobre igual que al rico. Ahora bien, esta situación Schelling explicaba que era contradictoria. Si el que no tiene hijos paga más, es lo mismo que decir que el que tiene hijos paga menos. Esto a su vez nos está diciendo que si queremos que el rico sin hijos pague más impuestos, esto equivale a querer que el rico con hijos tenga una mayor deducción fiscal. Reformular el problema hace que la respuesta cambie por completo.&lt;/p&gt;

&lt;p&gt;Enmarcar una propuesta en términos de pérdidas o de ganancias altera la conducta de quien toma la decisión. De igual modo tomar varias decisiones una detrás de otra o una sola que englobe todos los escenarios de golpe también altera el resultado. En el libro se menciona un ejemplo de &lt;a href=&quot;https://link.springer.com/content/pdf/10.1007/BF01073401.pdf&quot; target=&quot;_blank&quot;&gt;este artículo del propio Kahneman&lt;/a&gt;. En él se preguntaba por cuánto se estaba a dispuesto a pagar para salvar delfines respecto a cuánto se estaba dispuesto a pagar para ayudar trabajadores del campo que padecen cáncer de piel. En el libro nos cuentan que se está más dispuesto a dar más dinero a los delfines, aunque la diferencia no es muy elevada (12.57\$ vs 12.18\$, con elefantes sí que es algo mayor la diferencia). El autor explica que si se presentasen a la vez estas cuestiones nos daríamos cuenta de que en un caso estamos ayudando a una persona y en otro no, por lo que la cifra se revertiría, aunque no aporta evidencia de ello. Sin embargo, de lo que sí aporta evidencia es de las sanciones de las agencias reguladoras estadounidenses. Una multa en materia de seguridad laboral está acotada en 7000 dólares mientras que la Ley de Conservación de Aves Silvestres contempla multas de hasta 25000 dólares. Dentro de cada agencia las sanciones son coherentes entre sí, pero al no haber una puesta en común, los resultados terminan siendo muy dispares. Si hubiese un marco regulatorio común, estos resultados no se observarían.&lt;/p&gt;

&lt;h2 id=&quot;teorema-de-calibración-de-mathew-rabin&quot;&gt;&lt;a href=&quot;http://www.dklevine.com/archive/refs47667.pdf&quot; target=&quot;_blank&quot;&gt;Teorema de calibración de Mathew Rabin&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Este teorema es una continuación de las contradicciones del apartado anterior pero formalizado matemáticamente. Es una prueba de que si rechazas este juego:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;50% probabilidad de perder 100€ y 50% probabilidad de ganar 110€.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;También deberías rechazar este otro:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;50% probabilidad de perder 1000€ y 50% probabilidad de ganar 2.000.000€.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Lo que resulta contradictorio. El teorema se enmarca dentro de la teoría de la utilidad esperada donde las decisiones se toman en base a la esperanza de utilidad y no en función del dinero esperado. Se define una función $U(w)$ que devuelve el valor de la utilidad sobre una cantidad de dinero $w$. Y un maximizador como ellos lo llaman es aquel que se basa en esa función para decidir. Por ejemplo, rechazar la primera apuesta descrita anteriormente se traduce en $0.5 \cdot U(w-100) + 0.5 \cdot U(w+110) &amp;lt; U(w)$. Y aceptar la segunda es equivalente a $0.5 \cdot U(w-1000) + 0.5 \cdot U(w+2.000.000) &amp;gt; U(w)$. Pues la implicación de que aceptar una conlleva aceptar la otra y vice versa no es otra cosa que una descripción de la función de utilidad. En el apartado de la ley de Weber se mostraba que la utilidad del dinero es una función cóncava. Esto nos viene a decir que si trazas una recta sobre dos puntos en la curva, esta quedará por debajo de la propia función. Y esa es la hipótesis final que faltaba para rematar el teorema que dice como sigue:&lt;/p&gt;

&lt;div class=&quot;teorema&quot;&gt; 
Supongamos que para toda $w$ la función $U(w)$ es estrictamente creciente y cóncava. Supongamos también que existen $w_1$ y $w_2$ con $w_1 &amp;gt; w_2$ y que existen $g$ y $l$ con $g &amp;gt; l &amp;gt; 0$ tales que para todo $w \in [w_1, w_2]$
&lt;div&gt;$$0.5 \cdot U(w-l) + 0.5 \cdot U(w+g) &amp;lt; U(w)$$&lt;/div&gt;
entonces para todo $w \in [w_1, w_2]$ y para todo $x&amp;gt;0$ se cumplen estas dos condiciones, estando la primera sujeta a que $g \le 2\cdot l$:
&lt;div&gt;\begin{align}
U(w) - U(w - x) \geq&amp;amp; 
\begin{cases} 
2 \left( \sum_{i=1}^{k^*(x)} \left( \frac{g}{l} \right)^{i-1} r(w) \right) &amp;amp; \text{si } w - w_1 + 2l \geq x \geq 2l, \\
2 \left[ \left( \sum_{i=1}^{k^*(w - w_1 + 2l)} \left( \frac{g}{l} \right)^{i-1} r(w) \right) \right. \\
\left. + \left[ x - (w - w_1 + l) \right] \left( \frac{g}{l} \right)^{k^*(w - w_1 + 2l)} r(w) \right] &amp;amp; \text{si } x \geq w - w_1 + 2l;
\end{cases}
\\
U(w + x) - U(w) \leq &amp;amp;
\begin{cases} 
\sum_{i=0}^{k^{**}(x)} \left( \frac{l}{g} \right)^i r(w) &amp;amp; \text{si } x \leq w_2 - w, \\
\sum_{i=0}^{k^{**}(w_2)} \left( \frac{l}{g} \right)^i r(w) + \left[ x - w_2 \right] \left( \frac{l}{g} \right)^{k^{**}(w_2)} r(w) &amp;amp; \text{si } x \geq w_2 - w,
\end{cases}
\end{align}
&lt;/div&gt;
donde $k^*(x) = \lfloor x / 2l \rfloor$, $k^{**}(x) = \lfloor x / g + 1 \rfloor$ y $r(w) = U(w) - U(w-l)$
&lt;/div&gt;

&lt;p&gt;Quien quiera ver la demostración original puede dirigirse &lt;a href=&quot;http://www.dklevine.com/archive/refs47667.pdf&quot; target=&quot;_blank&quot;&gt;al artículo original&lt;/a&gt;. Pero no está muy pulida. Por ejemplo, la hipótesis de $0.5 \cdot U(w-l) + 0.5 \cdot U(w+g) &amp;lt; U(w)$ es innecesaria en la demostración. La propiedad descrita del teorema es válida para toda función cóncava. Una demostración algo más pulida con un análisis más riguroso de las hipótesis se halla en &lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0165176521004341&quot; target=&quot;_blank&quot;&gt;este artículo&lt;/a&gt; más moderno. De este teorema tan enrevesado se deduce un colorario que es el que se ha usado para justificar los escenarios del principio:&lt;/p&gt;

&lt;div class=&quot;corolario&quot;&gt;
Supongamos que para toda $w$ la función $U(w)$ es estrictamente creciente y cóncava. Supongamos también que existen $w_1$ y $w_2$ con $w_1 &amp;gt; w_2$ y que existen $g$ y $l$ con $g &amp;gt; l &amp;gt; 0$ tales que para todo $w \in [w_1, w_2]$
&lt;div&gt;$$0.5 \cdot U(w-l) + 0.5 \cdot U(w+g) &amp;lt; U(w)$$&lt;/div&gt;
Entonces para todo entero positivo $k$ y para todo $m &amp;lt; m(k)$ se cumple también
&lt;div&gt;$$0.5 \cdot U(w- 2\cdot k \cdot l) + 0.5 \cdot U(w+m \cdot g) &amp;lt; U(w)$$&lt;/div&gt;
siendo este multiplicador $m(k)$ tal que así:
&lt;div&gt;
\begin{equation}
m(k) \equiv 
\begin{cases}
\frac{\ln \left[ 1 - \left( 1 - \frac{l}{g} \right) 2 \sum_{i=1}^{k} \left( \frac{g}{l} \right)^i \right]}{ \ln \frac{l}{g}} - 1 &amp;amp; \text{if } 1 - \left( 1 - \frac{l}{g} \right) 2 \sum_{i=1}^{k} \left( \frac{g}{l} \right)^i &amp;gt; 0, \\
\infty &amp;amp; \text{if } 1 - \left( 1 - \frac{l}{g} \right) 2 \sum_{i=1}^{k} \left( \frac{g}{l} \right)^i \leq 0.
\end{cases}
\end{equation}
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Aquí es donde realmente sí que se usa la hipótesis de que $0.5 \cdot U(w-l) + 0.5 \cdot U(w+g) &amp;lt; U(w)$. Cabe decir que en la demostración de este corolario se asume que $[w_1, w_2] = \mathbb{R}$, es decir, que de las dos ramas de la función por partes del teorema solo se usa la rama de arriba la cual simplifica los cálculos. Traducido esto significa que la negativa a aceptar o rechazar los juegos propuestos al principio es irrelevante de la fortuna inicial. El propio Rabin reconoce este hecho y dice que incluso si el comportamiento del jugador varía en función de la fortuna inicial, se pueden llegar a conclusiones similares pero requiere de más operaciones algebraicas todavía y el resultado es algo menos fuerte. Para terminar de ejemplificar este corolario veámos qué sucedía en el primer juego. Rechazarlo significaba que $0.5 \cdot U(w-100) + 0.5 \cdot U(w+110) &amp;lt; U(w)$, por lo tanto con este corolario si tomamos $k=5$ nos queda que $1 - \left( 1 - \frac{l}{g} \right) 2 \sum_{i=1}^{k} \left( \frac{g}{l} \right)^i \approx -0.22 &amp;lt; 0$ por tanto $m$ puede ser cualquier valor quedando que $0.5 \cdot U(w-1000) + 0.5 \cdot U(w+2\cdot 10^6) &amp;lt; U(w)$, o lo que es lo mismo, que rechazaríamos jugar aunque el premio fuera de dos millones de euros.&lt;/p&gt;

&lt;h2 id=&quot;valores-decisorios&quot;&gt;Valores decisorios&lt;/h2&gt;

&lt;p&gt;La asimetría entre la búsqueda del riesgo en las pérdidas y la aversión al riesgo en las ganancias se extiende un poco más en un patrón de cuatro opciones:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/cuatro.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En un intento por explicar esta situación y además resolver la problemática del teorema anterior, Amos y Kahneman hacen una modificación a la función de utilidad añadiendo una función de ponderación de probabilidades. Esta función ha ido evolucionando con el tiempo. El concepto es sencillo, si tienes dos opciones eliges la que tiene mayor valor. Pero calcular ese valor es complicado. En el modelo más básico los agentes racionales simplemente eligen la opción que repercute más ganancias y menos pérdidas, es decir, siguiendo la notación anterior eliges la opción donde $w$ es mayor ($V=w$). Tras analizar que los eventos tienen probabilidades se mide el valor esperado de la ganancia y no la ganancia per se, o sea,&lt;/p&gt;

&lt;div&gt;$$V=\mathbb{E}[w] = Pr(A_1) \cdot w_1 + \dots + Pr(A_n) \cdot w_n$$&lt;/div&gt;

&lt;p&gt;Cuando se consigue entender que el valor monetario no corresponde con el valor real se añade una función de utilidad que es la $U(w)$ y el valor real pasa a ser&lt;/p&gt;

&lt;div&gt;$$V=\mathbb{E}[U(w)] = Pr(A_1) \cdot U(w_1) + \dots + Pr(A_n) \cdot U(w_n)$$&lt;/div&gt;

&lt;p&gt;Y finalmente, para parchear las incongruencias que resultan del comportamiento humano se añaden ponderaciones a las probabilidades obteniendo la formulación de la teoría de perspectivas:&lt;/p&gt;

&lt;div&gt;$$V=\pi(Pr(A_1)) \cdot U(w_1) + \dots + \pi(Pr(A_n)) \cdot U(w_n)$$&lt;/div&gt;

&lt;p&gt;Es difícil hacer más flexible el marco teórico. Y en concreto cabe preguntarse si $\pi(x) = x$ o no, porque de ser así es una complicación innecesaria. Eso es lo que hicieron Amos y Kahneman en &lt;a href=&quot;https://web.mit.edu/curhan/www/docs/Articles/15341_Readings/Behavioral_Decision_Theory/Kahneman_Tversky_1979_Prospect_theory.pdf&quot; target=&quot;_blank&quot;&gt;su artículo sobre esta teoría&lt;/a&gt;. Para estimar las ponderaciones preguntaron a los participantes sobre qué decisiones tomarían. Siendo las decisiones como esta:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;50% de probabilidad de ganar 1000€ y 50% probabilidad de no ganar nada.&lt;/li&gt;
  &lt;li&gt;100% de probabilidad de ganar 450€.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Variando las cuantías monetarias y las probabilidades de este tipo de preguntas se puede estimar la función de ponderación $\pi(\cdot)$ de los participantes. El resultado lo presenta en la tabla 4 del capítulo 29.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/tabla.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quedando palpado el hecho de que $\pi(x) \neq x$. En la traducción al español llaman a esta función de ponderación el valor decisorio. Traducción que no considero muy acertada dada la connotación de la propia formulación. Es cierto que es un valor decisorio porque el experimento utiliza el valor a partir del cual prefieres la opción segura a la opción azarosa. Sin embargo, si se mira desde los ojos del marco teórico esa tabla tiene más sentido si se habla de ponderaciones. En cualquier caso, lo que el estudio de estos valores muestra es que las personas no ponderan las probabilidades de forma lineal. Un incremento del $2\%$ de la probabilidad tiene mucho más peso si es del $98\%$ al $100\%$ que si es del $61\%$ al $63\%$.&lt;/p&gt;

&lt;h1 id=&quot;efecto-ancla&quot;&gt;Efecto ancla&lt;/h1&gt;

&lt;p&gt;Este efecto queda ilustrado y medido con &lt;a href=&quot;https://psycnet.apa.org/record/1996-24980-001&quot; target=&quot;_blank&quot;&gt;el siguiente experimento&lt;/a&gt;. En él se les preguntó a los participantes una de estas dos cuestiones:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;¿Es la altura de la secuoya más alta mayor o menor de 1.200 pies?&lt;/li&gt;
  &lt;li&gt;¿Cuál es su estimación de la altura de la secuoya más alta?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;El valor inicial que se da en la pregunta es lo que denominan ancla. Los valores de las preguntas previas eran 844 y 282 respectivamente. Como se puede observar, la presencia del ancla mueve la media en dirección del valor inicial mencionado en la pregunta. Esto es el efecto ancla, que hace que las estimaciones estén condicionadas por el primer valor que se escucha. Y el índice de anclaje es el ratio entre la diferencia de las medias y la diferencia de la media sin ancla y el ancla. O sea, en el caso anterior sería $(844 - 282) / (1200 - 282) = 0.55$, un cincuenta y cinco por ciento.&lt;/p&gt;

&lt;p&gt;Este efecto afecta a todos los mortales. Los expertos tasadores inmobiliarios y los jueces no son excepciones. En &lt;a href=&quot;https://psycnet.apa.org/record/1987-12447-001&quot;&gt;otro estudio&lt;/a&gt; se vio que el índice de anclaje de los tasadores era del 41%. Sus tasaciones se veían afectadas por cifras que los investigadores les habían dado momentos antes de visitar las viviendas. El grupo de control que no tenía conocimientos inmobiliarios sufría un anclaje del 48%, ligeramente superior. Y más sorprendente es el índice de anclaje de los jueces. &lt;a href=&quot;https://psycnet.apa.org/record/2006-00011-005&quot; target=&quot;_blank&quot;&gt;Un estudio&lt;/a&gt; con jueces alemanes mostró que su índice de anclaje era del 50%. En ese experimento a los jueces se les hacía tirar un dado antes de evaluar las condenas. Los dados estaban trucados para que salieran 3 o 9. El resultado fue que los jueces a los que le salía un 9 tendían a dar condenas más altas que aquellos que el dado les marcaba un 3. Este no es el único condicionante mencionado en el libro que afecta a los jueces. En otro capítulo Kahneman nos cuenta como los jueces israelíes tendían a negar la condicional a los reclusos que las solicitaban si el momento de evaluar el informe se daba próximo a la hora de comer. En &lt;a href=&quot;https://pubmed.ncbi.nlm.nih.gov/21482790/&quot; target=&quot;_blank&quot;&gt;ese experimento&lt;/a&gt; los jueces no sabían que les estaban estudiando.&lt;/p&gt;

&lt;h2 id=&quot;ley-de-los-pequeños-números&quot;&gt;Ley de los pequeños números&lt;/h2&gt;

&lt;p&gt;Ese es el nombre que Kahneman le dio a la ignorancia del tamaño muestral a la hora de sacar conclusiones. En muestras pequeñas es posible encontrar resultados sorprendentes debido a la varianza del proceso. Para obtener una conclusión certera uno debe asegurarse de tener una muestra grande para que no quede lugar a dudas. En ese capítulo me llamaron la atención dos ejemplos de esta ley. El primero es el hecho de que los condados con menor tasa de cáncer renal son rurales. La vida en el pueblo es más sana se podría concluir. Pero también es un hecho que los condados con mayor tasa de cáncer renal también son rurales. Debido a que estos condados tienen menor población, la tasa de cáncer renal sufre una mayor varianza. Esto hace que sean los pueblos pequeños los que destaquen con estadísticas muy grandes y también muy pequeñas por puro azar. El segundo ejemplo es más llamativo porque costó 1700 millones de dólares a la fundación Gates. Querían averiguar qué colegios eran mejores y llegaron a la conclusión de que los más pequeños. Lo que los llevó a promover la creación de escuelas más pequeñas. Lo más probable es que sus resultados se debieran precisamente a ley de los pequeños números.&lt;/p&gt;

&lt;h2 id=&quot;efecto-de-dotación&quot;&gt;Efecto de dotación&lt;/h2&gt;

&lt;p&gt;Este efecto se ilustra con el ejemplo de &lt;a href=&quot;https://www.unz.com/print/MilkenInstituteRev-2001q2-00022/&quot; target=&quot;_blank&quot;&gt;un artículo&lt;/a&gt; de Alan B. Krueger. En él se habla de cómo los encuestados no estarían dispuestos a pagar 3000\$ por una entrada de la super bowl porque es muy cara pero a su vez no venderían una entrada por menos de 3000\$. El efecto de dotación es el término usado para referirse a la diferencia entre los precios de compra y venta de los usuarios cuando se trata de bienes de uso vs bienes de intercambio. En las transacciones habituales se vende un objeto que costó 20€ por esa misma cantidad. Pero cuando el poseedor del producto le asocia un valor emocional, el precio de venta y el de compra difieren. El alcance de este efecto y las formas de hacerlo desaparecer aún están por estudiar comenta Kahneman.&lt;/p&gt;

&lt;p&gt;La explicación que da Kahneman de este efecto de dotación se basa en la asimetría de las ganancias y las pérdidas. Perder 1€ duele más de la alegría que da ganarlo, como se veían en las gráficas previas de la función de utilidad. Esto hace que se genere esa asimetría de los precios de compra y venta. Esta misma aversión a la pérdida &lt;a href=&quot;https://psycnet.apa.org/record/2018-70020-001&quot; target=&quot;_blank&quot;&gt;se estudió&lt;/a&gt; en el entorno matrimonial quedando registrado que el éxito a largo plazo depende más de evitar lo negativo que de perseguir lo positivo.&lt;/p&gt;

&lt;h2 id=&quot;felicidad&quot;&gt;Felicidad&lt;/h2&gt;

&lt;p&gt;Hacia el final del libro se trata sobre varios resultados referentes al estudio de la felicidad. La metodología tiene sus puntos débiles, y considero que esos puntos débiles quedan bastante bien plasmados en &lt;a href=&quot;https://www.maximumtruth.org/p/data-dive-money-does-not-buy-much&quot; target=&quot;_blank&quot;&gt;este post reciente&lt;/a&gt; de Maxim Lott. Aún así son resultados interesantes los que se presentan en el libro. El más remarcable es que la felicidad crece con los ingresos pero se estanca en 75000 dólares al año. Hay múltiples fuentes de este dato, en el libro se basan en &lt;a href=&quot;https://www.pnas.org/doi/10.1073/pnas.1011492107&quot; target=&quot;_blank&quot;&gt;este artículo&lt;/a&gt; de 2010 realizado por el propio Kahneman. Cuando veo este resultado siempre pienso que me gustaría que hubiese resultados similares en España. El índice de bienestar Gallup-Healthways que es el que se mide en ese estudio solo involucra estadounidenses. Eso hace que sea muy difícil interpretar el resultado. Porque 75000 dólares en Estados Unidos y en 2010 no tienen un equivalente sencillo de calcular en la España de 2024.&lt;/p&gt;

&lt;p&gt;Otro hallazgo curioso es que el sufrimiento se distribuye de forma poco uniforme. En &lt;a href=&quot;https://journals.sagepub.com/doi/10.1111/j.1467-9280.1996.tb00354.x&quot; target=&quot;_blank&quot;&gt;el artículo&lt;/a&gt; titulado “La mayor parte de la gente es feliz” nos cuentan que en general la gente no experimenta episodios desagradables salvo una minoría que sufre por todos los demás. El resultado se remonta a 1996, mucho antes de las redes sociales y la globalización, por lo que es posible que ya no sea tan aplicable.&lt;/p&gt;

&lt;p&gt;Y el último resultado que presento en esta entrada del blog es la gráfica de satisfacción en la vida antes y después del matrimonio&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/fast_slow/matrimonio.png&quot; alt=&quot;gaussian pdf&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dejo al lector o lectora que la interprete como quiera.&lt;/p&gt;

&lt;h2 id=&quot;conclusión&quot;&gt;Conclusión&lt;/h2&gt;

&lt;p&gt;El objetivo del autor con este libro es proporcionar nuevo vocabulario a sus lectores para sus charletas frente a la maquinilla del café, al mismo tiempo que intenta informar a la sociedad de los sesgos cognitivos que todos padecemos. Es la obra de toda una vida dedicada a la investigación pero desprovista de formalismos y en un lenguaje bastante accesible. Evidentemente el autor tiene sus opiniones y su visión es claramente parcial, algo que él mismo reconoce en el libro cuando habla de una de sus rivalidades con sus adversarios intelectuales. Pero los experimentos son los que son y los datos son datos, no opiniones. Cada cual ha de formarse su propia opinión en base a esos datos con calma y sin prisas. Para mí al principio mi reacción a todos estos resultados no era otra que pensar que el ser humano es imbécil y cabezota. Tras reflexionar debidamente finalmente he concluido que la conducta humana es mucho más compleja de lo que parece. Nuestras experiencias nos forman intuiciones del mundo que habitamos que con frecuencia no son completamente acertadas. Nuestra capacidad ejecutiva se ve afectada por factores externos que raras veces controlamos y tener conocimiento de ello no resuelve el problema. Las apariencias engañan y es muy difícil ser plenamente objetivo y racional. No obstante, cada día se sabe más y se descubren nuevas herramientas para amortiguar el impacto de los sesgos cognitivos. La sociedad evoluciona lentamente, pero lo hace en la dirección correcta.&lt;/p&gt;

&lt;h2 id=&quot;extra&quot;&gt;Extra&lt;/h2&gt;

&lt;p&gt;Este experimento no es del libro, lo cual es imposible porque es de hace pocos años, pero me llamó mucho la atención. Yo lo conocí por &lt;a href=&quot;https://twitter.com/Aella_Girl/status/1594144435000213505&quot; target=&quot;_blank&quot;&gt;este tweet&lt;/a&gt;. En él se dice a los participantes que giren una ruleta en su cabeza que tienen un $20\%$ de probabilidad de salir amarillo y un $80\%$ de salir rojo. Después se hace una encuesta preguntando a la gente que de qué color ha salido la ruleta al girar en su cabeza. El resultado de la encuesta es que alrededor del $80\%$ dijeron que salía rojo y alrededor del $20\%$ dijeron que salía amarillo. Otras personas han reproducido el mismo resultado con otros porcentajes y otras redes sociales y los porcentajes de la encuesta suelen estar en un margen del $5\%$ respecto a las probabilidades imaginarias. Curioso, ¿verdad?&lt;/p&gt;
</description>
        <pubDate>Tue, 16 Jul 2024 00:00:00 +0000</pubDate>
        <link>https://granadata.art/fast_slow/</link>
        <guid isPermaLink="true">https://granadata.art/fast_slow/</guid>
        
        <category>Stories</category>
        
        <category>Philosophy</category>
        
        <category>Psychology</category>
        
        <category>Economy</category>
        
        
        <category>Stories</category>
        
        <category>Philosophy</category>
        
        <category>Psychology</category>
        
        <category>Economy</category>
        
      </item>
    
      <item>
        <title>How to build a python library</title>
        <description>&lt;p&gt;When I was halfway through my bachelor’s thesis I decided to package everything into a python package to facilitate easier usage for the next student. However, instead of just following a simple and nice tutorial I decided to read and study the relevant PEPs and the official setuptools documentation. That was quite time consuming but also very worth it. I will always recommend getting as deep as you can in every topic you are interested. This post is a summary of the fundamental takeaways. Packaging in python has changed over the last years, so what you will find here is probably not used in some of the packages you already know. The post is structured as follows: first, the summary. Then, some extra details. And finally, some anecdotes.&lt;/p&gt;

&lt;h1 id=&quot;packaging-your-code&quot;&gt;Packaging your code&lt;/h1&gt;

&lt;p&gt;The process is very simple once you know how to do it. You just need to put every code file inside a folder, add a pyproject.toml file, run some commands and you are done. For example, my library was called tumourkit, so I put everything I got so far into a folder called tumourkit. Now, the most basic pyproject.toml can be this:&lt;/p&gt;

&lt;div class=&quot;language-toml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nn&quot;&gt;[build-system]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;requires&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;[&quot;setuptools&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;61.0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;build-backend&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;setuptools.build_meta&quot;&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[project]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tumourkit&quot;&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;authors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Jose Pérez Cano&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;joseperez2000@hotmail.es&quot;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;A SDK for tumour study&quot;&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;requires-python&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;&quot;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;3.8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;dynamic&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[tool.setuptools.dynamic]&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;requirements.txt&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, the file structure should be&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root-folder
├── tumourkit
│   ├── ...
├── pyproject.toml
├── requirements.txt
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With that, you just need to install some packages &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;python -m pip install twine build wheel&lt;/code&gt; and run two commands: &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;python -m build&lt;/code&gt; and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;python -m twine upload dist/*&lt;/code&gt;. With that you are done.&lt;/p&gt;

&lt;p&gt;You will be probably thinking that this is very simple, and you are right. Packaging code can get quite complex, but for the most part it is just this. There are some extra additions you can consider. Like adding a readme, exposing some command line programs, tagging the package or including a license. Many of the previous changes can be done by simply adding some lines to the project section:&lt;/p&gt;

&lt;div class=&quot;language-toml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nn&quot;&gt;[project]&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;readme&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;README.md&quot;&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;license&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;LICENSE&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;classifiers&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Development Status :: 2 - Pre-Alpha&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Environment :: Console&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Intended Audience :: Healthcare Industry&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Programming Language :: Python :: 3.8&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Programming Language :: Python :: 3.9&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Programming Language :: Python :: 3.10&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;Typing :: Stubs Only&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are many classifiers, a full list can be found &lt;a href=&quot;https://pypi.org/classifiers/&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;. And the file structure should now include the extra files:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root-folder
├── tumourkit
│   ├── ...
├── pyproject.toml
├── requirements.txt
├── README.md
├── LICENSE
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the commands it is also very simple. Suppose you have a function called &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;main&lt;/code&gt; under the file &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;tumourkit/example.py&lt;/code&gt; and you want to call that command &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;my_example&lt;/code&gt;. Then you could add these lines to the toml:&lt;/p&gt;

&lt;div class=&quot;language-toml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nn&quot;&gt;[project.scripts]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;my_example&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tumourkit.example:main&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So now, when the library is installed running &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;my_example&lt;/code&gt; in the terminal is equivalent to running that function. You don’t need to have the classical &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;if __name__=='__main__'&lt;/code&gt;, in fact it will get ignored. The choosing of the license could be a topic for another day. For now, I will just mention that my library ended up being AGPL-3.0.&lt;/p&gt;

&lt;p&gt;Even though this is enough for a package to be distributed, many of the packages you know have far more files than just the four I mentioned. That is because packages also have documentation, testing, building, excluded / included non-code files and many more. For every extra thing you add to your package, you will need an extra file that contains information about that. In my case I only added one more file which is &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;.readthedocs.yaml&lt;/code&gt;. This file is read by the read the docs servers and contains the information on how to build the documentation. The file was just copied from &lt;a href=&quot;https://docs.readthedocs.io/en/stable/config-file/v2.html&quot; target=&quot;_blank&quot;&gt;their page&lt;/a&gt;. This is something to be done incrementally. Whenever something is required you look up the relevant documentation and include it. Following the philosophy of doing things incrementally, it is also a good practice to &lt;a href=&quot;https://keepachangelog.com/en/1.1.0/&quot; target=&quot;_blank&quot;&gt;keep a CHANGELOG.md&lt;/a&gt; and follow &lt;a href=&quot;https://semver.org/&quot; target=&quot;_blank&quot;&gt;semantic versioning&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;the-rabbit-hole&quot;&gt;The rabbit hole&lt;/h1&gt;

&lt;p&gt;All of the above is now very well explained &lt;a href=&quot;https://packaging.python.org/en/latest/tutorials/packaging-projects/#&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;. But when I decided to do it, it was a period of transition. There were some online tutorials that still referred to the old-fashioned setuptools way of doing things. Until only very recently, setuptools was the only way of doing things. You needed a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;setup.py&lt;/code&gt; file that was run to build the egg files that where then installed or uploaded. But the python foundation decided it was time to democratize it. PEP 517 specified how to create new build backends so that others could emerge. We now have poetry, flit, hatchling and others. Also, to simplify the configuration file, in PEP 518 the pyproject.toml was introduced. This was written in 2016 and 2017. But it took a few years until backends started to appear. Between 2018 and 2019 setuptools added support for pyproject.toml in version 40 and you no longer needed to add the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;setup.py&lt;/code&gt; file even if you use setuptools. I did my thesis in 2023. It would seem as if 4 years were enough for the world to adapt to those changes. But it wasn’t. I think in most cases packages are built once and used forever, but never fully maintained. The cost of being up to date with those changes is quite high with no reward at all. I dit it this way because it was my first time, so I thought I better be doing it the updated way. But I can understand that you don’t want to change the way everything is configured now that it is working.&lt;/p&gt;

&lt;p&gt;Python is always evolving. In the past months the PEP 703 showed up proposing a way to remove the GIL, which is probably one of the most representative aspects of the language, together with the garbage collector. And some very characteristic features like pip, were not in the beginning. In the beginning there was distutils and easy_install. It was in 2013 with PEP 453 that pip was proposed as the default. However, community often rejects wide adoption as with the type hints. They were proposed in PEP 484 in 2014 but as of today, I can only find them in very mature libraries. Amateurs just use python without types. And that is fine. There is no need to be knowledgeable about everything. Sometimes the basics are more than enough. That is something I really like about computer science. You can do a lot knowing so little, but if you want to know more, there is always more.&lt;/p&gt;

&lt;h1 id=&quot;anecdote&quot;&gt;Anecdote&lt;/h1&gt;

&lt;p&gt;I was hired by the university when I was doing my bachelor’s thesis to develop an algorithm that could solve a problem. That means you obtain money in exchange for some freedom on what you can and cannot do. In my case that meant to provide guidance to others in the project and that I wasn’t the one taking the decisions about priorities. Packaging code is time consuming, and therefore I needed to ask my “boss” about whether or not I should spend time on that. However, I just wanted to do it, so I dit it. But since I needed to justify myself I did the following. On a friday night I emailed my tutors asking for permission. I knew they were busy so they wouldn’t respond until next monday. During saturday I spent more than 10 hours reading and making changes to the code so that it could be a package. There were around 5 thousand lines of code, but luckily I could refactor everything in one day. When sunday arrived, I just emailed again saying the absence of response was an approval and that I have just done everything that was needed. They couldn’t say no, after all, the work is already done. Normally, you won’t get blamed for doing more, only for doing less. If you want to build something, just do it.&lt;/p&gt;
</description>
        <pubDate>Sun, 24 Mar 2024 00:00:00 +0000</pubDate>
        <link>https://granadata.art/Python/</link>
        <guid isPermaLink="true">https://granadata.art/Python/</guid>
        
        <category>Python</category>
        
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>The Hack Life</title>
        <description>&lt;p&gt;Believe or not today I got up at 4am to take a train Madrid -&amp;gt; Barcelona to work for more than 24 hours straight for free. Why? Melancholy. Melancholy is such a strong emotion and it’s not given enough credit. We love to dwell in past memories and try to revive the happy ones. Today, I got the opportunity to feel a fading emotion: Youth. There are certain lifestyles and choices that get lost when we get older, more mature. Coding at 2am is one of them. It’s 2am again, and instead of coding this time I will be writing about my hacking adventures.&lt;/p&gt;

&lt;p&gt;Okay, that was a quite poetic and obscure introduction. Quite contrary to the very specific intros that we are used to see in this blog. What is the hack life I mention in the title? Let me introduce you to the concept of a hackaton. Hundreds of students in the same place coding a solution to a challenge in a weekend. That is the official definition. &lt;em&gt;Unofficially&lt;/em&gt;, a hackaton is a place to meet awesome friends, life-long friends, a place to learn from more experienced people about technical topics and receive advice about life. There are funny activities and deep lore. Like the ducks in the HackUPC. It was in my first hackaton that I met my crew. At that time we didn’t know each other but created a team and participated together. Now we are besties. How do we go from there to writing a post at 2am in a faculty where I no longer study? Stay with me, it is a long story.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/hacklife/biene.svg&quot; alt=&quot;biene&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In total I have assisted to 6 hackatons / datathons. The HackUPC 2019, 2021, 2023, MamutHack, CFIS Datathon and Hacknights. After that, I wanted to be in the other side of the event, to be an organizer. I helped organize the second datathon FME on 2022 and today was the third datathon FME, which I am also helping organize. This is probably the last time I will be at either side of a datathon / hackaton. Only time will tell, but it definitely feels like so. I am in a position where I know personally many of the people that participate, being this either their first time or second time. I also know other organizers and I even know personally many sponsors, both in companies and universities. A datathon is the people that composes it. When time passes, and people goes, the datathon dies. Figuratively. For me. For others it is a discovery. (As a side note, when I was midway writing this paragraph the whole electricity of the faculty went off, more on that later). Where was I? Ah, yes, the cycle of the hackaton. You participate, you organize, you sponsor and you continue with your life. It is like that summer romance that you will never forget but you will also never continue with. That’s life, continuous change. No matter how hard you try to repeat some memorable memory, it will never be the same. You are not the same, can’t experience it the same way. You only have one chance to enjoy it.&lt;/p&gt;

&lt;p&gt;Back to the hackaton stuff. Living a hackaton, and specially a HackUPC comes with lots of anecdotes. You may end up shooting nerfs to random scandinavian people. Or find a ruber duck below a random chair. The first time I participated I was sucked deep into the challenges. Full focus in coding and giving the best solution. Spoiler: It was not. As a first year student you have no experience nor knowdledge. And this type of challenges would normally require months of full-time work to fully develop. You are only supposed to build a quick MVP. But the first (and second) time, it is about learning. The real challenge is to learn to code and code at the same time. Do you want a webapp? Great! Learn Javascript, HTML and CSS all at once from scratch and then apply the knowdledge. Do you want to build a vision classifier? Fantastic! Look for a github repo with a pretrained classifier, learn how to tweak the solution to your needs and do it. It is a way of learning by building. By hacking. If something does not give the perfect solution, instead of doing a whole course to fix everything you just learn or create any trick that does the job. The power in it comes from doing it during 36 hours straight. It is a very condensed way of studying. I will probably never be as focused as I was in those first hackatons.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/hacklife/focus.png&quot; alt=&quot;focus&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once you get older you start valueing other aspects of the events. More personal. Less technical. And that is when I knew I preferred to deliver food and give advice rather than to code. When you are a volunteer, everybody asks you. You get to know many more people. And you get to see wonderful ideas. When I was participating it was all about me, about my solution and my algorithm. Which is fine. However, when you start hearing many team’s ideas you learn a lot. In this datathon I was surprised several times with the Mango challenge. Mango brought a problem where you were given a set of good-looking outfits and where asked to analyse it and recommend 10 new outfits. Said like that is looks quite interesting. But if you know a bit about machine learning you know this problem is ill-posed. You only have positive labels. It is the most imbalanced dataset possible. My first thought was to simply create ugly outfits and label them as negative. But this approach is highly subjective which will make the model subjective. Teams came up with way better methods. One suggested to build a classifier with pairs of garments. Every outfit is composed of several garments. You can construct positive pairs by looking at existing combinations and consider every combination that is not in the dataset as negative. This is a natural way to recover the balance in the dataset. It is not perfect, but is a very interesting idea. Other team tried to build a markov model and construct the outfit iteratively. To learn the probabilities they just assumed independence between attributes and computed ratios. Simple, yet possible useful. Maybe these approaches get you nowhere, but the ideas are amazing. The creativity is not something you can learn. Everybody is creative in its own way. Being a mentor provides you with the opportunity to discover new ideas from others.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/hacklife/creative.png&quot; alt=&quot;creative&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the second datathon FME, the first I helped organize I discovered this new world. And I met lots of mentorees (I can’t find an appropiate enough word for this type of relationship). Meeting with them again, seeing how they have evolved it’s what fills me. That and coming to see my crew again. All the work that needs to be done, moving tables, giving food, solving doubts. It is all paid in a different way. As an unforgettable experience. This is the reason when this datathon was announced I immediately bought tickets to come here from Madrid. And what a datathon. There is yet one day to come and it is already my most memorable datathon. Last year some students built a tower of plastic glasses as big as a person and enclosed a person in it. Well, this datathon also had some architecture classes. This time with pizza boxes.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/hacklife/arc.jpeg&quot; alt=&quot;arc&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It was a bit chaotic and full of rustle up. There are 100 more students and we tried the same logistic strategy which didn’t work as well. We learned a lot in the process and manage to get everyone fed which is a major statement. I also guided many people with ideas on how to proceed with the challenges. From my perspective, I am only giving ideas. I know perfectly that implementing such ideas is the real deal. And sometimes they look at me and say: “Yeah, putting the data in wide format, then one-hot encoding it and apply a PCA sounds fine, but how the hell do I do that?”. Others are more advanced technically, but less knowdledgeable in project management. Surely you can apply a very complex network, but have you tried a linear model as your baseline? There are many ways to arrive at a solution. Some are way harder than others. Advancing in the right direction can save you time and headaches. Sadly, you only learn that with experience. No matter what I tell them they will make the same mistakes as I made. And that is the beauty of life. At least I can warn them about the difficulty of the process.&lt;/p&gt;

&lt;p&gt;Remember the light incident I told you about before? The organizers also have our challenges. Buying 7kg of yogurt at the last moment because we miscalculated how much was needed was one of them. And another challenge was dealing with plug shortages. Being so much people, all with computers, requires electricity and plugs. The building was not prepared for so much load. First, we needed to buy more adaptors to cover the demand. And in the middle of the night, at the most unexpected moment, the net got overloaded. Part of the job.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/hacklife/enc-hombros.jpg&quot; alt=&quot;encogerse de hombros&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So that’s the hack life. A very short life. It became a part of me when I started university and it is leaving me now that I am leaving university. When I get older I will look back and remember with melancholy those years. With the nostalgia of a time that cannot be recovered, but that was spent in the best way possible.&lt;/p&gt;
</description>
        <pubDate>Sun, 12 Nov 2023 00:00:00 +0000</pubDate>
        <link>https://granadata.art/hack_life/</link>
        <guid isPermaLink="true">https://granadata.art/hack_life/</guid>
        
        
        <category>Philosophy</category>
        
        <category>Stories</category>
        
      </item>
    
      <item>
        <title>Crowdsourcing methods for cancer detection</title>
        <description>&lt;p&gt;I recently survived the reviewing process of a scientific article called: “Annotation protocol and crowdsourcing multiple instance learning classification of skin histological images: The CR-AI4SkIN dataset” and today I want to explain what all those fancy words mean. The article is currently accessible through &lt;a href=&quot;https://authors.elsevier.com/c/1hypg3KEGaNNII&quot; target=&quot;_blank&quot;&gt;this link&lt;/a&gt; although Elsevier will paywall it in some weeks. Ironically enough, this is my first published article despite it being the second article I wrote. The peer review process is so unpredictable that some articles take 18 months to review while others take 2 months. At the end of this post I will also talk in more detail about how broken the peer review system is, with examples of the things we were asked to do to publish this article.&lt;/p&gt;

&lt;h1 id=&quot;the-problem&quot;&gt;The problem&lt;/h1&gt;

&lt;p&gt;The problem at stake here is skin cancer classification. One of the most used tests to analyse the seriousness of a tumour is a biopsy. It is a technique that consists of extracting a piece of the affected organ and digitalizing the image for a physician to look at. The magnification of the microscope allows the cells to be seen in the image and so the pathologist can recognise cancerous structures and tell if they are malignant or benign. An example of such image which are called Whole Slide Images (WSI) in the case of lung is below:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/wsi-lung.png&quot; alt=&quot;wsi&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The tiny little red square that you see there corresponds to this zoomed in image:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/square.png&quot; alt=&quot;zoom&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As you can see those images are massive, and analysing them requires time and effort. Not only that, each tissue is different, the above was for lung, but the skin looks more like this:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/square-skin.jpg&quot; alt=&quot;skin&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And worse than that, there are several different ways to stain the cells. This is the cheapest staining which is called Hematoxylin and Eoxin, but there are others like the immunohistochemistry that creates a better distinction between tumoural and non-tumoural cells but are more expensive. The problem we tackled in the article was to detect if a given WSI corresponded to malignant tissue or not.&lt;/p&gt;

&lt;p&gt;This type of problem can also be described in the context of Multiple Instance Learning (MIL). In a MIL setting you have to classify a bag of elements into a given class where each individual element has its own class that influences the overall class of the bag. For instance, imagine you want to give a score of how good a basketball team is. If you have Stephen Curry or Lebron James in the team the overall score goes up. The difference in the MIL setting is that you don’t know how good each player is, you just know how the team performed in the last matches. And you try to infer based on that. If you know the team scored 30 three-point shots then you may assume there is one hyperscorer and if in another match the team does not score one single three-point shot then you may be inclined to think that hyperscorer is not playing. This is the type of latent information that we try to discover in a MIL setting. By analysing bag of images we try to find some patterns in the individual images that help analyse other bags of images, without ever knowing anything specific about those images, just knowing about the whole bag.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/basket-unknown.png&quot; alt=&quot;zoom&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To be more specific, what we want is to split the WSI into smaller images and be able to classify the WSI only by classifying all the zoomed in patches and then aggregating the result. If we detect one patch to be malignant, then the WSI is quite probable malignant, no matter whether the other images are malignant or not. By looking at many malignant WSI it is possible to extract patterns about the smaller patches and learn to classify those as well. One reasonable question is why? Why is useful to split the image in little pieces? Why not classify the WSI as a whole? The reason is because it is not technically possible at the moment. Training a convolutional neural network (or worse, a transformer) may require TBs of GPU RAM which is impossible right now. And even if that were possible, the amount of data to train such models will also need to be huge, which is not at the moment. The dataset we published in the article has less than 300 patients. Current AI models require billions of images for working at 512x512 resolution. Imagine what is needed for 100000x100000 resolution.&lt;/p&gt;

&lt;p&gt;But the problem does not finish there. A MIL classification problem is something already quite studied, that is not worthy of an article. The problem is far more complicated. In a MIL setting you ignore the individual labels (they are considered latent variables) and try to infer them using Ground Truth (GT) bag-level labels. Well, what if we don’t even have a Ground Truth? That’s right, labelling medical images requires doctors, but what if we could avoid that little annoyance? What if we could use non-expert annotators instead? Instead of training with expert labels, the problem we faced was to train with annotations that were made by students. Students are cheaper and are more prone to collaborate in research. If we could somehow learn when each of the students is making a mistake we could correctly obtain the GT by asking several students. That is called crowdsourcing.&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/genie.png&quot; alt=&quot;crowd&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To sum up, the problem we face is to classify huge medical images were we only have access to noisy labels during training.&lt;/p&gt;

&lt;h1 id=&quot;the-solution&quot;&gt;The solution&lt;/h1&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/solution.jpg&quot; alt=&quot;solution&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first step to reduce the dimensionality of the problem is to train a Region of Interest (ROI) prediction algorithm. The WSIs have a lot of white pixels that can be discarded. To extract such ROIs the experts annotated some regions and then a network trained on that subset of WSI was used to predict the ROI of the rest of the dataset. After that the WSIs were splitted into 512x512 images at 10x magnification. As a reference, the maximum level of magnification is 40x, so we also reduced the dimensionality here by working with more pixelated patches. That is this part of the diagram:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/solution1.png&quot; alt=&quot;sol1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The next step to reduce even more the dimensionality was to train a convolutional neural network in an unsupervised manner to obtain feature vectors. This way we could reduce 512x512 images into vectors of dimension 256. Even more than that, we aggregated the feature vectors of each image inside a WSI. So we went from between 100 and 1000 images to just one single vector of 256 numbers. That unsupervised method is called &lt;a href=&quot;https://arxiv.org/abs/2002.05709&quot; target=&quot;_blank&quot;&gt;SimCLR&lt;/a&gt;. It consists of a very special loss called normalized temperature-scaled cross-entropy loss (NT-Xent). Mathematically it can be expressed like this:&lt;/p&gt;

&lt;div&gt;$$ 
\begin{equation}
    \ell_{i,j} = - \log \frac{\exp(\text{sim}(\bf{h}_i,\bf{h}_j) / \tau)}{\sum_{k=1}^{2S}\mathbb{1}_{k\neq i}\exp(\text{sim}(\bf{h}_i,\bf{h}_k) / \tau)} 
\end{equation}
$$&lt;/div&gt;

&lt;p&gt;The $\bf{h}$ are the feature vectors. Unlike other common losses, this loss is not computed independently for each item in the batch and then aggregated. This loss takes into account every element in the batch and is computed for each positive pair and then aggregated. A positive pair is a pair of images that should be considered similar, and a negative pair one that should be considered different. For instance, an image and its reflection or rotation are considered similar while two images of two different patients are considered dissimilar. This way by minimizing this loss one is maximizing the similarity of positive pairs (numerator) at the same time that it is minimizing the similarity between negative pairs (denominator). Where the similarity is measured using cosine similarity. The result is that the network is training to have a separable latent space. Such property is very useful for training classifiers on that latent space. The rest of the parameters in that formula are not quite relevant. The $\tau$ is the temperature but is always fixed at $0.5$ and the $S$ is the batch size which is limited by the RAM you have, so there is not much room for improvement there. Surprisingly, we found that a batch size of 256 gives better results than one of 512. This is surprising because in the original SimCLR article they stated that anything below 512 was useless. Well, it is not.&lt;/p&gt;

&lt;p&gt;We have covered the top right of the diagram:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/solution2.png&quot; alt=&quot;sol2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With that we overcome the limitations of the MIL setting and reduce the problem to a strongly-supervised one. The next step is to solve the crowdsourcing problem, which is the last part of the diagram:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/solution3.png&quot; alt=&quot;sol3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To solve it we can model the problem as a bayesian network. In a bayesian network you have observable variables and latent variables. All the variables influence each other in some way, either as a prior distribution or a dependency relation or in many other ways. The key here is the Bayes Theorem. It lets us go forward and backward. If by knowing the distribution of A we can know the distribution of B, then the reverse also holds. If we know B we can get A. This means that if the output depends on some latent variable we can infer some information about that unknown variable by observing the output. In our case, the bayesian network is visualized in this diagram:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/crowdsourcing/bayesnet-hd.jpg&quot; alt=&quot;bayesnet&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here $\bf{x}_i$ are the input images and $\bf{y}_b^a$ are the non-expert annotations. Those are the only two variables that are observable. And everything that is in between must be inferred in order to obtain a model that predicts labels from images. There are two parts to distinguish in this diagram. The crowdsourcing part and the Gaussian Process part. One models how each annotator behaves while the other adds extra latent variables to make the model more robust and scalable. The easiest to understand is the crowdsourcing part. There are true labels $\bf{z}_b$ for each bag $b$ and each annotator $a$ has a confusion matrix $\bf{R}^a$ that describes the probability that they make a mistake. We don’t know such probabilities neither the true labels, but we aim for discovering them based on the data. Such thing is possible whenever the majority of the annotators are better than random and not adversarial annotators. But even if there is only one adversarial annotator, that is, someone that says exactly the opposite of the truth, it is possible to identify it and correct their labels.&lt;/p&gt;

&lt;p&gt;The Gaussian Process part is adding an extra latent variable called $\bf{f}_b$ that is more or like a hidden layer in a neural network. It is supposed to capture the relations between new samples and all the training samples so that it can provide a prediction based on similarities computed with some kernel function. Since computing the covariance matrix with respect to all the training data has cubic cost, there is yet another latent variable called inducing points or $\bf{u}_m$ that is supposed to summarise all the content of the training data into just a reduced set of points. There is a lot of theory behind this way of modelling, if any of you is interested in all the maths you can refer to the original &lt;a href=&quot;https://arxiv.org/abs/1911.01915&quot; target=&quot;_blank&quot;&gt;LIGO paper&lt;/a&gt; that designed this model. Or if you want to know about gaussian processes you can refer to the original article of the &lt;a href=&quot;https://arxiv.org/abs/1411.2005&quot; target=&quot;_blank&quot;&gt;scalable version of the GPs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To summarise in a simple phrase the whole method, we are reducing dimensionality by first extracting a ROI, then applying a pretrained network to obtain latent variables, and after that we are applying a crowdsourcing method to classify those extracted features learning from noisy labels. Believe or not, this is not an original method, it is just “a mechanical combination of existing methods”. Or that is what a reviewer said.&lt;/p&gt;

&lt;h1 id=&quot;curiosities&quot;&gt;Curiosities&lt;/h1&gt;

&lt;p&gt;The problem and the solution are explained with more detail in the paper. I would like this blog post to contain information that is not published, to reveal other more enjoyable facts that are not told anywhere. During this project we found many results that were not only counterintuitive but sometimes outright against the theory. Since there is the possibility that those facts were due to some implementation detail and not due to the method itself, we didn’t publish them, or didn’t highlight them too much.&lt;/p&gt;

&lt;p&gt;The first interesting fact is that the initialization of the parameters of the GP affected the result in a very dramatic way. Going from 1 to 2 make the model improve quite drastically. That is surprising because the model must converge to the same value no matter how you initialise it. And it is even more surprising that such a little change can affect so dramatically the output. Contrary to neural networks, GPs have much less parameters. And changing the initialization of just two of them can change the result. This is something that does not happen on other problems or is very difficult to replicate, but it happened to us.&lt;/p&gt;

&lt;p&gt;The second interesting fact, and this one was the matter of many discussions, is that the crowdsourcing model is sometimes better that a model trained with the expert labels. That is, using non-expert labels can bring better results than using expert labels. At first this caused some commotion. The other authors thought that this implied the experts were not so expert after all. And we even thought about not publishing the article, because such a result could invalidate the test labels. However, the experts are indeed experts and this fact has nothing to do with that. The reason why a &lt;em&gt;model&lt;/em&gt; trained on non-experts labels outperforms a &lt;em&gt;model&lt;/em&gt; trained on expert labels is not because the &lt;em&gt;labels&lt;/em&gt; are worse, but because the &lt;em&gt;model&lt;/em&gt; is worse. In machine learning there is one thing called the bias-variance tradeoff where you can obtain better results in a regression problem by reducing the variance even if your model is systematically worse (high bias). In regression one can reduce variance by using ensembles. Without improving the quality of the members of the ensemble, the overall result improves if you perform the mean. In crowdsourcing something similar happens, but this time it is classification and not regression, and instead of bias and variance we have precision and recall. What we found is that the model trained on experts has a higher recall. And that has a lot of sense. Doctors have a tendency to diagnose an illness even if not present because the alternative is worse. It is better to do more tests than to say one is healthy wrongly. For that reason, training with expert labels tends to have that tendency too. The magical part of using crowdsourcing is that it increases precision out of thin air. By averaging the annotations of several people a similar effect as with an ensemble is achieved. This way, even though all the individual non-expert annotators have lower precision than the experts, when combining them they achieve higher precision. So, the conclusion is that doctors are very cautious and to obtain a more precise answer one should ask several doctors.&lt;/p&gt;

&lt;p&gt;The third fact is a consideration about the research process itself. When we started this project we were quite sure that the method was going to give better than random results easily. Wrong! This database was absurdly difficult to work with. We had to perform a very exhaustive hyperparameter search and even when doing so it was not enough the first time. Initially we were not going to use SimCLR. We tried to use the crowdsourcing method alone. But the method was designed for low dimensions and so we had to try a way to simplify things. And even after finding SimCLR it was not enough because it provided feature vectors for images, not for WSIs. In the end, we made some very arbitrary decisions like simply averaging the vectors instead of using some attention mechanism. And after all that was done, we still had to perform an exhaustive search over the hyperparameters of the model. When we began the project we thought we could iterate at least three times, and we barely manage to iterate once. That is why the model only tackles the binary case even though the database is multiclass. And that is why our model is not end to end. Those two ideas were supposed to be done after achieving a simple baseline. But achieving such simple baseline ended up consuming all the time.&lt;/p&gt;

&lt;p&gt;The last amazing fact is that the validation set does not correlate with the test set. Truly inspiring isn’t it? The metrics we obtained in the validation set were around 60% or so while the metrics from train and test were around 70 and 80%. And the best performing model in the validation was rarely the best performing model on the test set. That is why the metrics we report on the article are so low sometimes. Not because the model itself is bad in the test, but because the best set of hyperparameters in the validation set is not the best set in the test. Since you cannot use the test set for hyperparameter tuning, the result ended up being worse than expected. If I were to start the project again, I would choose the split to have similar images on all of the splits while not mixing the patients. The current split makes it impossible to infer useful information. It is even better to do the tuning on the training than on the validation set. This is a reason not to deploy any model trained on this database, since you cannot be sure it won’t drift on new patients.&lt;/p&gt;

&lt;h1 id=&quot;the-reviewing-process&quot;&gt;The reviewing process&lt;/h1&gt;

&lt;p&gt;We are used to hear many scientis complain about the peer review system and I now know why. All the reviewers wanted was for us to cite their articles. They criticised that we didn’t mention this or that article. And after looking at all the proposals we found that they all had the same author in common, what a coincidence! This is a recurring theme, in the other article I have the same happened. It is not something strange. Even the editor in chief advises you not to give up to the citation abuse in their mails.&lt;/p&gt;

&lt;p&gt;Yet not every request is about citing them, some are about “pinta y colorea”. Little changes about how the figures are made or the colours we use. For instance, if you look at the bayesian network above you will see it is blue. That was a request from the reviewers. Initially it was black and white like in the thumbnail of the post but that change was proposed “To enhance the originality and
clarity of the method’s approach”.&lt;/p&gt;

&lt;p&gt;Worse than that is when the reviewers simply ask you to improve your english. The article has been supervised by more than five people who have been working on this for decades and have several hundreds of articles published and the reviewer still thinks the english is improvable. I sometimes think the reviewers didn’t even read the article and criticised based on the title and little more.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Research has its ups and downs, but I like it. The happiness that fills your heart when your method is finally improving and giving good results is very different than any other emotion. It is different than selling a product to a client or developing a new feature in an app. It feels as if you are discovering a new world. Although when the time passes you look back and think “What a useless piece of … did I do there?”. That is progress though, improving means what you did is now obsolete. Many people is afraid of change. I am not one of them. I embrace it. Whenever I have the possibility of learning something new I try. Even if that means learning that all your efforts in the past year are now a commodity. That is compensated by the amazing new thing you just discovered. I hope I will always be discovering new and better technology and science for that is what improves the quality of life of everybody.&lt;/p&gt;
</description>
        <pubDate>Thu, 09 Nov 2023 00:00:00 +0000</pubDate>
        <link>https://granadata.art/crowdsourcing/</link>
        <guid isPermaLink="true">https://granadata.art/crowdsourcing/</guid>
        
        
        <category>Deep Learning</category>
        
        <category>Unsupervised Learning</category>
        
        <category>Supervised Learning</category>
        
      </item>
    
      <item>
        <title>How to make a full audiobook with AI tools.</title>
        <description>&lt;p&gt;A few days ago I got access to DALLE·3 and thought, “what if I made a book for children with it?” It may seem a bold idea, but as you will see, it played out decently and that’s the reason for this tutorial. Since there is not yet a full consensus on the copyright of this material, I won’t be posting the full audiobook just in case. But if you follow this tutorial you may end up with a similar copy in your hands. The process is quite simple:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Ask GPT-4 to structure a book around a given topic, which in my case was “animals in Africa”.&lt;/li&gt;
  &lt;li&gt;Create the figures using DALLE·3.&lt;/li&gt;
  &lt;li&gt;Give texture to letters using Adobe text effects.&lt;/li&gt;
  &lt;li&gt;Compose letters and images in powerpoint.&lt;/li&gt;
  &lt;li&gt;Generate the audio using Tortoise.&lt;/li&gt;
  &lt;li&gt;Edit video and audio using Davinci Resolve.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The objective is to reduce the human in the process as much as possible, although some careful editing and reviewing will always be neccesary. Let’s dive into the details.&lt;/p&gt;

&lt;h1 id=&quot;gpt-4&quot;&gt;GPT-4&lt;/h1&gt;

&lt;p&gt;One would think that a lot of prompt engineering is needed to make a full book, even if it is for children, right? Well, no. The prompt I used was simply this:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;hey, i want to create a child book for my nephew, he loves animal from africa, like giraffes and lions and pumas. Would you like to help me build a narrative together with the proper animations?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Yeah, that’s it! Even with caligraphic errors GPT-4 understood the task and gave me this in response:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;narrative&quot;&gt;Narrative:&lt;/h3&gt;

  &lt;p&gt;&lt;strong&gt;Title&lt;/strong&gt;: “The Great African Adventure”&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;1. Introduction&lt;/strong&gt;:
In a land far away, where the golden savannah stretches as far as the eye can see, three unlikely friends embark on an unforgettable journey. Meet Gigi the Giraffe, Leo the Lion, and Pippa the Puma.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;2. The Lost Waterhole&lt;/strong&gt;:
One day, Gigi notices that their favorite waterhole is starting to dry up. The three friends decide to search for a new one, ensuring they have water during the hot summer days.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;3. The Mysterious Map&lt;/strong&gt;:
While resting under an acacia tree, Pippa finds a tattered map blowing in the wind. It hints at a hidden waterhole, surrounded by lush greenery and cool shade. They decide to follow it.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;4. Challenges Along the Way&lt;/strong&gt;:
As they journey, they face various challenges. They cross rapid rivers, climb steep hills, and navigate through dense forests. Each friend uses their unique abilities to help the group. Gigi uses her long neck to scout ahead, Leo roars to scare away potential threats, and Pippa’s agility helps them find shortcuts.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;5. The Hidden Oasis&lt;/strong&gt;:
After days of searching, they stumble upon a hidden oasis, just as the map had shown. It’s more beautiful than they could have imagined, with fresh, clear water and plenty of food.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;6. Conclusion&lt;/strong&gt;:
The trio realizes that their journey was about more than just finding water. It was about friendship, teamwork, and the adventures they shared. They decide to keep the map as a reminder of their great African adventure.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now, let’s create some illustrations to go with our story. I’ll start by creating images for the introduction and the first two events. Shall we?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Not bad, but not a book either, this is more like a summary. So, given that summary, I then asked GPT-4 to create the full book, chapter by chapter. This was my prompt for the introduction:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Okay, let’s be more sistematic. We have 6 chapters. Let’s start with the introduction. Write me a simple story that would fit in 5 pages with one sentence in each page. Also, for each page an illustration is needed. The characters must be the same as before: Gigi the Giraffe, Leo the Lion and Pippa the Puma.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;And the response:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;introduction-meeting-the-trio&quot;&gt;Introduction: Meeting the Trio&lt;/h3&gt;

  &lt;p&gt;&lt;strong&gt;Page 1&lt;/strong&gt;:
&lt;strong&gt;Sentence&lt;/strong&gt;: “In the heart of the African savannah, three friends stood tall and proud.”
&lt;strong&gt;Illustration&lt;/strong&gt;: A vast savannah landscape with Gigi the Giraffe, Leo the Lion, and Pippa the Puma standing together, the sun setting in the background.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Page 2&lt;/strong&gt;:
&lt;strong&gt;Sentence&lt;/strong&gt;: “Gigi, with her long neck, loved to watch the clouds and dream.”
&lt;strong&gt;Illustration&lt;/strong&gt;: Gigi gazing upwards at the sky, a dreamy expression on her face, as whimsical cloud shapes float above.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Page 3&lt;/strong&gt;:
&lt;strong&gt;Sentence&lt;/strong&gt;: “Leo, with his majestic mane, loved to roar and ensure everyone was safe.”
&lt;strong&gt;Illustration&lt;/strong&gt;: Leo standing on a small mound, letting out a powerful roar, with birds taking flight in the background.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Page 4&lt;/strong&gt;:
&lt;strong&gt;Sentence&lt;/strong&gt;: “Pippa, always curious, loved to explore hidden paths and trails.”
&lt;strong&gt;Illustration&lt;/strong&gt;: Pippa sneaking through some tall grass, her tail flicking with excitement, as she discovers a hidden trail.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Page 5&lt;/strong&gt;:
&lt;strong&gt;Sentence&lt;/strong&gt;: “Together, they were ready for any adventure the savannah had in store.”
&lt;strong&gt;Illustration&lt;/strong&gt;: The three of them walking side by side, with the vast savannah ahead, signaling the beginning of their journey.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Let’s start by creating the illustrations for these pages. Shall we?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;And this is the process, you tell GPT-4 how many pages you want per chapter and it expands the summary to fit into that number of pages. Even better, it suggests some illustrations, let’s see how to make them a reality.&lt;/p&gt;

&lt;h1 id=&quot;dalle3&quot;&gt;DALLE·3&lt;/h1&gt;

&lt;p&gt;A few months ago, to achieve the illustrations one would have to take the prompt suggested by GPT-4 and take it to Midjourney, or Stable Diffusion to generate a valid image. The process required a lot of trial and error and a bit of prompt engineering. Now, however, DALLE·3 is embedded inside GPT-4, so you just have to say “yes” and it will generate the illustrations, like this:&lt;/p&gt;

&lt;div class=&quot;image-grid&quot;&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/dalle1-1.png&quot; alt=&quot;dalle1_1&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/dalle1-2.png&quot; alt=&quot;dalle1_2&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/dalle1-3.png&quot; alt=&quot;dalle1_3&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/dalle1-4.png&quot; alt=&quot;dalle1_4&quot; /&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Since it is limited to generating four at a time you need to generate them in batches, which is a minor problem since you can just say “continue” and it will do the rest. As you can notice, even though I did not specify any specific style or artist, these images do not seem to be copyright-free. Some of them resemble too much to Disney style or to other cartoons. Technically, OpenAI gives you ownership of this images to do whatever you want, commercial or not. But it is not clear to me that you are really allowed to &lt;em&gt;do whatever you want&lt;/em&gt;. The problem is, even if I wanted to credit the authors of this material, or ask for permission to cite, or even request a commercial license, I don’t know &lt;em&gt;who&lt;/em&gt; is the author I should be asking permission for. Anyway, the process is as simple as I described here and it is more or less automatic. In many cases the algorithm does not generate what I ask it for, but by repeating the question several times you can arrive to a satisfying image almost always.&lt;/p&gt;

&lt;p&gt;Next step, generating covers for every chapter. This is a bit more challenging since generating letters in images is a quite difficult task, and it fails horribly most of the time. For instance, generating the words “The Hidden Oasis” seems an impossible task, here are some examples of the failure cases:&lt;/p&gt;

&lt;div class=&quot;image-grid&quot;&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail1.png&quot; alt=&quot;fail1&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail2.png&quot; alt=&quot;fail2&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail3.png&quot; alt=&quot;fail3&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail4.png&quot; alt=&quot;fail4&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail5.png&quot; alt=&quot;fail4&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;image-container&quot;&gt;
        &lt;img src=&quot;/assets/images/audiobook/fail6.png&quot; alt=&quot;fail4&quot; /&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;With a lot of trial and error I could manage to get cover for all of the chapters, but re-generating the illustrations to include extra text on them seemed and impossible task. For that reason I decided to edit the text in Adobe Firefly.&lt;/p&gt;

&lt;h1 id=&quot;adobe-text-effects&quot;&gt;Adobe text effects&lt;/h1&gt;

&lt;p&gt;I could have just used plain colors for the text, but it seemed too boring, so I decided to try this AI tool. By using a prompt like “moon” you could add texture to your letters based on it, although the result is not quite there yet in my opinion:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/audiobook/text1-1.png&quot; alt=&quot;text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;For every prompt, no matter what I told to the tool it always gave me dark images. I surrendered and decided to apply a gain to the result if the background was also dark. Nonetheless, I used this tool for all the images because I found it funny, look, there is another example:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/audiobook/text2-3.png&quot; alt=&quot;text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This one is a bit more special, because I didn’t use any original prompt, I just used the whole sentece provided by GPT-4 “The oasis was a paradise, with crystal-clear water and an abundance of food.”. This way everything is automatic, you use the sentence as prompt to give texture to itself. The biggest limitation is that the tool only allows a few characters at a time, which made the process quite long and exhausting. The most consuming part was realizing that the text was not even useful because the color didn’t match the scene. This is probably the worst part of the book and the part that has the most room for improvement in terms of AI tools.&lt;/p&gt;

&lt;h1 id=&quot;tortoise&quot;&gt;Tortoise&lt;/h1&gt;

&lt;p&gt;Given the catastrophic failure that the letters were, we need to fix it somehow. A possible solution for an unreadable text is to create an audiobook. Can’t you read the text? No problem, here is somebody reading it for you. Well, more like &lt;em&gt;something&lt;/em&gt;. Because we are going to use another AI tool to generate the voices automatically. This tool is not deployed on any pages like the previous tools. If you want to use it you will need to install it in your machine or in colab. In their &lt;a href=&quot;https://github.com/neonbjb/tortoise-tts&quot; target=&quot;_blank&quot;&gt;github repository&lt;/a&gt; you have instructions on how to do it. You will need an NVIDIA GPU with CUDA capabilities or a mac with Apple Silicon or a lot of time, you choose. In my case I have a Mac M1 Max and the generation of all the 33 audios took one and a half hour. As an example, the following command generated the audio that is below:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;PYTORCH_ENABLE_MPS_FALLBACK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 python tortoise/do_tts.py &lt;span class=&quot;nt&quot;&gt;--text&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;I am really excited,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\]&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; Let's follow the birds; they'll lead us to water.&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--voice&lt;/span&gt; train_dreams &lt;span class=&quot;nt&quot;&gt;--preset&lt;/span&gt; fast &lt;span class=&quot;nt&quot;&gt;--output_path&lt;/span&gt; book/chapter2/audio4/ &lt;span class=&quot;nt&quot;&gt;--candidates&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--seed&lt;/span&gt; 210501&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;audio controls=&quot;&quot;&gt;
    &lt;source src=&quot;/assets/audio/audiobook/chapter2_audio4_2.mp3&quot; type=&quot;audio/mpeg&quot; /&gt;
    Your browser does not support the audio element.
&lt;/audio&gt;

&lt;p&gt;The quality is decent. Its main limitation is the generation of emotions. As you can see in the example above, it is possible to trick the algorithm into expressing emotions, but there is much room for improvement and you need to specify which emotion you want. You could probably use GPT-4 to automatically identify which emotions to give, but for this side project I didn’t want to overcomplicate things.&lt;/p&gt;

&lt;h1 id=&quot;davinci-resolve&quot;&gt;Davinci Resolve&lt;/h1&gt;

&lt;p&gt;Finally, let’s put everything together and generate the audiobook. We have images, text and audio. So, we can create a video. In my case I decided to compose images and text in powerpoint and then use a predefined animation to pass between pages. Then, I put the presentation in automatic mode giving each slide 8 seconds and recorded the screen. After that, I had to manually synchronize audio and video by cutting and moving segments. Here is the timeline before editing:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/audiobook/before.png&quot; alt=&quot;before&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And here is after editing:&lt;/p&gt;

&lt;p class=&quot;text-center&quot;&gt;&lt;img class=&quot;&quot; src=&quot;/assets/images/audiobook/after.png&quot; alt=&quot;after&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hit render and you are done.&lt;/p&gt;

&lt;h1 id=&quot;final-thoughts&quot;&gt;Final thoughts&lt;/h1&gt;

&lt;p&gt;The whole process took me 3 days, but I was experimenting the most part. If this was fully automated it could be done in 1 day. Imagine, a editorial could put a hole office of, let’s say, 20 employees and create 400 books in a month. Even more, if the process gets even more automatic, a child could read a different book each day of its whole life, or at least until this kind of books bore them. Nobody can deny this technology is going to have a huge impact in ours lives. Either positive or negative is still to be seen. For me, this can have a good impact since it will democratize knowledge even more. Not only that, people will be able to create masterpieces, books, films and many more. You will no longer need a huge budget to do this kind of things. Indie creators could compete with huge studios or editorials. It will all depend on what the legislation will say. If future (or present) politicians decide against this technology, that democratization will never arrive. Big fishes will remain big, and monopolies will win. As much as I believe this technology is capable of wonderful creations, I also believe that politicians are capable of awful laws. Time will say.&lt;/p&gt;
</description>
        <pubDate>Sun, 15 Oct 2023 00:00:00 +0000</pubDate>
        <link>https://granadata.art/gpt4-audiobook/</link>
        <guid isPermaLink="true">https://granadata.art/gpt4-audiobook/</guid>
        
        
        <category>Stories</category>
        
        <category>Tutorial</category>
        
        <category>AI</category>
        
      </item>
    
      <item>
        <title>Deploying AWS webapp tutorial</title>
        <description>&lt;p&gt;Following the philosophy of my blog, this will be a very specific post. You can find many resources on the internet about how to deploy a web app.
I will even be referencing many of those here. But the main difference with those posts is that mine is going to be straight to the point.
The following is a tutorial on how to create a web app from scratch. The backend will be on Django and the database will be Postgresql.
The app will be running on AWS and to deploy it there we will create a Docker image. Last but not least, I’ll explain how to buy a domain and link the domain to the AWS ip address. Let’s get ours hands dirty! Also, don’t worry about the code, it is all available &lt;a href=&quot;https://github.com/Jerry-Master/GranaData/tree/main/_code/django_docker_aws&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;django-and-postgresql&quot;&gt;Django and Postgresql&lt;/h1&gt;

&lt;p&gt;Let’s start by creating a minimal python environment with just Django. You can do it either via python or conda. For reproducibility, please use python3.10 and Django 4.2.2. Open a terminal and run the following:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;python3.10 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; venv .venv
&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; .venv/bin/activate &lt;span class=&quot;c&quot;&gt;# For Windows use: .\.venv\Script\activate&lt;/span&gt;
pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;django&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;4.2.2 psycopg2-binary
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the Conda installation:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;conda create &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; .venv &lt;span class=&quot;nv&quot;&gt;python&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3.10
conda activate .venv
pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;django&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;4.2.2 psycopg2-binary
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;postgresql-server-setup&quot;&gt;Postgresql server setup&lt;/h2&gt;

&lt;p&gt;The next step is to create a prosgresql server. To install postgresql go to the &lt;a href=&quot;https://www.postgresql.org/download/&quot; target=&quot;_blank&quot;&gt;official page&lt;/a&gt;. Once installed, you need to start running the server on your system:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; /usr/local/var/postgres  &lt;span class=&quot;c&quot;&gt;# Create folder if it does not exist&lt;/span&gt;
initdb &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; /usr/local/var/postgres  &lt;span class=&quot;c&quot;&gt;# Initialize database cluster&lt;/span&gt;
pg_ctl &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; /usr/local/var/postgres start  &lt;span class=&quot;c&quot;&gt;# Start server&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will start the server and save everything into the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;/usr/local/var/postgres&lt;/code&gt; folder. For Window users, replace &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;pg_ctl&lt;/code&gt; and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;initdb&lt;/code&gt; with the path to the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;pg_ctl.exe&lt;/code&gt; and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;initdb.exe&lt;/code&gt; binaries, which may be something similar to &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;&quot;C:\Program Files\PostgreSQL\14\bin\pg_ctl.exe&quot;&lt;/code&gt; and use any data directory you want.&lt;/p&gt;

&lt;p&gt;Once the server is running we need to create a database, for that, you need to run postgres in a terminal and execute the relevant SQL code:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;psql postgres  &lt;span class=&quot;c&quot;&gt;# Start SQL shell&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# CREATE DATABASE mydatabase;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# CREATE USER myuser WITH PASSWORD 'mypassword';&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# exit;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The commands are self-explanatory, just replace &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;mydatabase&lt;/code&gt;, &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;myuser&lt;/code&gt; and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;mypassword&lt;/code&gt; with what you deem appropiate. Now you have the database ready to use locally, you can connect to it using any database management system you want, I recommend &lt;a href=&quot;https://dbeaver.io/download/&quot; target=&quot;_blank&quot;&gt;Dbeaver&lt;/a&gt;. The connection is through localhost and port 5432. Later on we will see how to automate this process but for now, this is how it is done locally.&lt;/p&gt;

&lt;h2 id=&quot;django-webapp-setup&quot;&gt;Django webapp setup&lt;/h2&gt;

&lt;p&gt;Given the database, we need a web on top. With the python environment activated, run the following using any name you want:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;django-admin startproject myprojectname
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will create the basic skeleton for a Django project. We now have to configure the database and create a simple app to store data. Go to &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;settings.py&lt;/code&gt; and locate the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;INSTALLED_APPS&lt;/span&gt;&lt;/code&gt; variable. Append &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/code&gt; to the list, it should be like this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;INSTALLED_APPS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.admin&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.auth&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.contenttypes&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.sessions&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.messages&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.staticfiles&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also locate the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;DATABASES&lt;/span&gt;&lt;/code&gt; variable and modify it to contain the information necessary to connect to the posgresql database:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;DATABASES&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mydatabase&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;myuser&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PASSWORD&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mypassword&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;HOST&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5432&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since storing passwords in plain text is normally not a good idea, I recommend you use environment variables for that:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;DATABASES&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mydatabase&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;myuser&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PASSWORD&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;environ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# Don't forget to import os
&lt;/span&gt;        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;HOST&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5432&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can now provide the password through environment variables:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'mypassword'&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# Unix&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;DB_PASSWORD &lt;span class=&quot;s2&quot;&gt;&quot;mypassword&quot;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# CMD Windows&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$env&lt;/span&gt;:DB_PASSWORD&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;mypassword&quot;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# PowerShell Windows&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally, let’s create a simple page. Start by typing:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;python manage.py startapp simpleapp
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, modify &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;settings.py&lt;/code&gt; to include it by adding it to the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;INSTALLED_APPS&lt;/span&gt;&lt;/code&gt; variable:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;INSTALLED_APPS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.admin&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.auth&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.contenttypes&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.sessions&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.messages&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.contrib.staticfiles&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;simpleapp&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, we will add a very simple model and view to handle data. Our model will only contain names of users. Go to &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;simpleapp/models.py&lt;/code&gt; and add this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CharField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__str__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, create &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;simpleapp/forms.py&lt;/code&gt; and add this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;forms&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;.models&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;forms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ModelForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fields&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next, modify &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;simpleapp/views.py&lt;/code&gt; to include the following:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.views.generic.edit&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CreateView&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;.models&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;.forms&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserForm&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserCreateView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CreateView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;form_class&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserForm&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;template_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;user_form.html&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;success_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/create_user
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You also need to create the template under a templates folder, create &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;simpleapp/templates/user_form.html&lt;/code&gt; and insert this:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;button&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Create&lt;span class=&quot;nt&quot;&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last, we need to link the urls for everything to work properly. Create the file &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;simpleapp/urls.py&lt;/code&gt; and write:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.urls&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;.views&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserCreateView&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;urlpatterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;create_user/&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserCreateView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;create_user&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Go to the main &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;myprojectname/urls.py&lt;/code&gt; and edit it to be like this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.contrib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.urls&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.urls&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;include&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;urlpatterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;admin/&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;simpleapp/&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;simpleapp.urls&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now you are good to go. We can finally start adding rows to the database. For doing so, apply migrations and start the webapp:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;python manage.py makemigrations
python manage.py migrate
python manage.py runserver
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Open a browser, go to &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;http://127.0.0.1:8000/simpleapp/create_user/&lt;/code&gt; and you will be able to input users’ names. If it is your first time using Django, this is a whole lot, I know. This is a simple example using Django’s class-based views. Things can get very, very complex. The aim of this tutorial is to set up a minimal working webapp. For more information on Django, you can go to their &lt;a href=&quot;https://docs.djangoproject.com/en/4.2/&quot; target=&quot;_blank&quot;&gt;official documentation&lt;/a&gt;. Okay, close everything and let’s start our Docker journey. To stop the webapp run &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;ctrl+C&lt;/code&gt; and to stop the posgresql server run:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;pg_ctl &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; /usr/local/var/postgres stop
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;docker&quot;&gt;Docker&lt;/h1&gt;

&lt;p&gt;Setting everything from scratch is time consuming but if you only need to do it once, it is affordable. The problem comes when you want to migrate to other machines or you want to scale. Having to go through all the process above everytime is annoying. As I mentioned before, it would be nice to automate it. That’s when Docker comes into play. It is a way to pack everything up so that it can run on your machine, the cloud or a microwave, if it has Docker installed, of course. A Docker is basically made of a few configuration files that are used to construct an image that does whatever you want, in our case handle data through a web app. Having introduced the concept, let’s build a Docker for our web app.&lt;/p&gt;

&lt;p&gt;This section is mostly inspired by &lt;a href=&quot;https://learndjango.com/tutorials/django-docker-and-postgresql-tutorial&quot; target=&quot;_blank&quot;&gt;this other tutorial&lt;/a&gt;. Hand over there if you feel curious. Also, I recommend you giving a look at the &lt;a href=&quot;https://docker-curriculum.com/&quot; target=&quot;_blank&quot;&gt;official Docker beginner tutorial&lt;/a&gt; for more information on how to set up Docker and the basics of it.&lt;/p&gt;

&lt;p&gt;To start, create a Dockerfile inside of the Django project directory. Specify the following information on it:&lt;/p&gt;

&lt;div class=&quot;language-dockerfile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; python:3.10.2-slim-bullseye&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;WORKDIR&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; /code&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; . .&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;pip &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; requirements.txt
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You also need to create a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;requirements.txt&lt;/code&gt; with this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;django==4.2.2
psycopg2-binary
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You could simply install it with pip, but when the project grows you will be thankfull to have it all in a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;requirements.txt&lt;/code&gt; file. So, that’s the container of the webapp. Simple, right? However, we still need to connect it to a posgres database. For that we need to use docker compose to run another container with the database and connect them. For that, create a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; file with the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;version: &quot;3&quot;

services:
  web:
    build: .
    command: sh start.sh
    environment:
      - DB_PASSWORD
    volumes:
      - .:/code
    ports:
      - 8000:8000
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres:14
    restart: always
    ports:
      - 5432:5432
    environment:
      POSTGRES_DB: mydatabase
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - ./postgres_data:/var/lib/postgresql/data/
    healthcheck:
      test: pg_isready -U myuser -d mydatabase
      interval: 1s
      timeout: 10s
      retries: 10
      start_period: 30s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You will need to substitute &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;myuser&lt;/code&gt; and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;mydatabase&lt;/code&gt; with what you like most. To explain a bit what is happening here, we are running a postgres container, then performing healthy checks to be sure the database is running and after that we launch the webapp container. You could provide the password also there, but for security reasons is better to provide it through an environment variable, just like before. The database is stored in the folder &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;postgres_data&lt;/code&gt; locally, so that whenever you kill the container you don’t lose the data. The port 5432 is forwarded locally so you can connect to the database from your machine when the container is running and see the data.&lt;/p&gt;

&lt;p&gt;Wait! We have not finished yet. We need to create the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;start.sh&lt;/code&gt; and modify the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;myprojectname/settings.py&lt;/code&gt; file. The &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;DATABASES&lt;/code&gt; variable should look like this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;DATABASES&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;django.db.backends.postgresql&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mydatabase&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;myuser&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PASSWORD&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;environ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;HOST&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5432&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only change is on &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;HOST&lt;/code&gt;. It is now set up to &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;db&lt;/code&gt; which is the name of the posgres container. And the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;start.sh&lt;/code&gt; script is the following:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;python&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;py&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;makemigrations&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;python&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;py&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;migrate&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;python&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;py&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runserver&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8000&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is creating all the migrations needed to set up all the models from Django into postgres. Finally, just run the container:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;docker compose up
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To stop it, do &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;ctrl+C&lt;/code&gt; and then &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;docker compose rm&lt;/code&gt;. That’s it, that’s all you need to do to restart your webapp from anywhere. You can now take your code to any machine and you won’t need to set up posgres, python and django from scratch. Just install docker and run &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;docker compose up&lt;/code&gt;. Also, it is a good practice to include a &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;.dockerignore&lt;/code&gt;, just like &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;.gitignore&lt;/code&gt;. For this simple app I have&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;postgres_data/
Dockerfile
docker-compose.yml
*/__pycache__/
*/*/__pycache__/
*/*/*/__pycache__/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This way I don’t load any unnecessary files to the container, making it faster. So now that we have everything packed up in our bag, let’s travel. Let’s deploy the web to AWS for others to use it.&lt;/p&gt;

&lt;h1 id=&quot;aws&quot;&gt;AWS&lt;/h1&gt;

&lt;p&gt;Amazon Web Services are a way to deploy your code into servers that you don’t need to manage. This way instead of the cost of setting up a whole server, you just pay for the hours used. Nevertheless, you won’t save yourself the cost of configuring everything. Even though configuring AWS may be simpler than configuring a server, it is still an important investment of time. For that, I will provide here the bare minimum to make our webapp work on AWS. You will still need to read the AWS docs extensively, there are many tutorials online, but Amazon keeps changing the interface every so often. The only web that is for sure updated is the &lt;a href=&quot;https://docs.aws.amazon.com/&quot; target=&quot;_blank&quot;&gt;AWS official docs page&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;account-and-iam-roles&quot;&gt;Account and IAM roles&lt;/h2&gt;

&lt;p&gt;Before we can start configuring the server, we need to configure an account. For that you will need access keys. You can create access keys for your root account but it is not recommended. AWS recommends that you create role with less permissions than your root account (specially without billing permissions) and to use those access keys. In the past this was made using the Identity and Access Management (IAM) app. Now, it is being migrated to IAM Identity Center. Both methods still work as of this writing but I will explain the second one which is more updated. The following is a reduced version of &lt;a href=&quot;https://docs.aws.amazon.com/singlesignon/latest/userguide/getting-started.html&quot; target=&quot;_blank&quot;&gt;this tutorial&lt;/a&gt;. Go to the &lt;a href=&quot;https://console.aws.amazon.com/&quot; target=&quot;_blank&quot;&gt;AWS console&lt;/a&gt;. There look for the IAM Identity Center. Once on the IAM Identity Center you will need to create an user, create a permission set and link both. In the section User click to Add User and fill the neccesary information. Then, on permission sets, click on Create permission set and create the predefined role AdministratorAccess. After that, go to AWS accounts, select the account under root and click Assign users or groups. Select your created user, click next, select the role, click next, review it and click submit. Finally, to activate that user, you must open the mail you provided and register that user with some password. Before you continue, go to Dashboard and save your AWS access portal URL, that is the URL you need to use to log in with that user. Now, click that URL and sign in. Once you are logged in you should see your user and two links at the right: one for Management console and one for Command line or programatic access. Click the latter and you will see your access keys.&lt;/p&gt;

&lt;p&gt;The next step is to install and configure the AWS CLI. Go &lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt; and follow the steps for the installation. Once installed execute &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;aws configure&lt;/code&gt; and provide the access key and secret access key obtained previously. It will also ask for a region, I will be using &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;us-east-1&lt;/code&gt;. If you choose a different one you may encounter problems later on because the free tiers differ across regions. And for the output format choose &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;json&lt;/code&gt;. You are now (almost) ready to start launching instances.&lt;/p&gt;

&lt;h2 id=&quot;ec2-instances&quot;&gt;EC2 Instances&lt;/h2&gt;

&lt;p&gt;Having created our account it is time to create an instance where to deploy our webapp. If your page gets too large you may be interested in storing the database in S3 buckets, but for now I will store code and data in the same instance. You can find the docs for EC2 &lt;a href=&quot;https://docs.aws.amazon.com/ec2/index.html&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;. As before, I will summarize it to just use what we need. First, create the instance. For that go to the &lt;a href=&quot;https://us-east-1.console.aws.amazon.com/ec2&quot; target=&quot;_blank&quot;&gt;EC2 console&lt;/a&gt;. Under Instances section, click Launch instances. There give it a name, select the OS and arch (I recommend Ubuntu and x86-64), select the instance type (I will be using t2.micro cuase it is free), select a key-pair or create since you probably don’t have one and leave everything as default. Once you launched it you can now access your machine through ssh. In the instances section, you can click on your created instance and then click on Connect and it will give you instructions on how to connect. The next steps are to install Docker, copy your webapp to the instance, change the firewall of the instance to allow http and postgres traffic and finally deploy the app.&lt;/p&gt;

&lt;h3 id=&quot;installing-docker-again&quot;&gt;Installing Docker (again)&lt;/h3&gt;

&lt;p&gt;If you have chosen Ubuntu as your OS you can follow the instructions &lt;a href=&quot;https://docs.docker.com/engine/install/ubuntu/&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;. You just basically need to execute the following commands after accessing the machine:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;ca-certificates curl gnupg &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; 0755 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; /etc/apt/keyrings
curl &lt;span class=&quot;nt&quot;&gt;-fsSL&lt;/span&gt; https://download.docker.com/linux/ubuntu/gpg | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;gpg &lt;span class=&quot;nt&quot;&gt;--dearmor&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /etc/apt/keyrings/docker.gpg
&lt;span class=&quot;nb&quot;&gt;sudo chmod &lt;/span&gt;a+r /etc/apt/keyrings/docker.gpg
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;deb [arch=&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;dpkg &lt;span class=&quot;nt&quot;&gt;--print-architecture&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
  &quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; /etc/os-release &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$VERSION_CODENAME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; stable&quot;&lt;/span&gt; | &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;sudo tee&lt;/span&gt; /etc/apt/sources.list.d/docker.list &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And if you want to check that everything is working just do&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker run hello-world
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;upload-your-code-to-ec2&quot;&gt;Upload your code to EC2&lt;/h3&gt;

&lt;p&gt;You can copy your entire directory recursively into you EC2 instance with scp:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;scp &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; YOUR_KEY ./&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; ubuntu@YOUR_EC2_ADDRESS:.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-html highlighter-rouge&quot;&gt;YOUR_KEY&lt;/code&gt; is the key pair previously created and &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;YOUR_EC2_ADDRESS&lt;/code&gt; may look something like &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;ec2-30-29-46-221.compute-1.amazonaws.com&lt;/code&gt;. It is the same address that you use to ssh into your machine.&lt;/p&gt;

&lt;h3 id=&quot;changing-the-firewall&quot;&gt;Changing the firewall&lt;/h3&gt;

&lt;p&gt;In AWS, the instances have some security rules that control the inbound and outbound traffic of your app. By default all the ports are closed except for 22 which is the ssh port. We will need to open the port 80 and 5432 since they are the http and postgres ports. If you have an SSL certificate you could open the port 443 for https, but we will just use those two for now. Let’s go back to the &lt;a href=&quot;https://us-east-1.console.aws.amazon.com/ec2&quot; target=&quot;_blank&quot;&gt;EC2 console&lt;/a&gt; and go to Security Groups. Click on Create security group. Give it a name and add two inbound rules. You can just select HTTP and Postgresql in the dropdown menu and it will set the port for you automatically. Then, on source, select Anywhere IPv4 and click Create security group. Now go back to your created instance and click Actions &amp;gt; Security &amp;gt; Change security groups. There simply add the newly created security group and you are free to go.&lt;/p&gt;

&lt;h2 id=&quot;deploy-the-app&quot;&gt;Deploy the app&lt;/h2&gt;

&lt;p&gt;In order to deploy our app we need to make one change to our &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;. Initially we were redirecting port 8000 into 8000, we are now going to redirect it to 80 which the http port. The line to change will end up like this&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;ports:
  - 80:8000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally, ssh into your machine with docker installed and execute&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;... docker compose up &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remember that you have to specify the password of the database as a environment variable. Okay, the app is running but, how can we access it? Well, we cannot. We still need to make some changes. Stop the container and let’s finish this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;... docker compose down
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first thing to know is what is the IP that we can use to access this page. In the AWS console, when you enter your instance it displays somewhere “Public IPv4 address”. That is the IP of your app. However, if you were to enter there, Django will not let you in. That is because you need to allow that host. For that, go the &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;setting.py&lt;/code&gt; of your app and add it:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;ALLOWED_HOSTS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;YOUR_IP&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, even after changing this, when you access your ip you don’t see the page. That is because the base url is not pointing anywhere, but we can fix that. Create a view that only has the redirection:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.shortcuts&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;redirect&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;redirect_to_create_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;redirect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/simpleapp/create_user&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, in your main &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;urls.py&lt;/code&gt; add &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;path('', redirect_to_create_user)&lt;/code&gt;, it will end up like this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.contrib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.urls&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;django.urls&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;include&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;.views&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;redirect_to_create_user&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;urlpatterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;redirect_to_create_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;admin/&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;simpleapp/&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;simpleapp.urls&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, copy again all the files into your machine and deploy the webapp:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;... docker compose up &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;accessing-the-database&quot;&gt;Accessing the DataBase&lt;/h3&gt;

&lt;p&gt;Let’s see how we can access the server database locally. Open you favourite DB program (mine is DBeaver) and create a new connection. This time you will have to provide an URL instead of localhost. Everything else is the same as when you did it locally. The port is 5432, the user is what you gave it, and the database name is what you name it. If you have configured properly the EC2 security group you could now access your database locally.&lt;/p&gt;

&lt;h1 id=&quot;web-domain&quot;&gt;Web Domain&lt;/h1&gt;

&lt;p&gt;Nice, we have our fantastic webapp up and running, but wait, are you going to share to your friends the page 50.283.48.100? Obviously not, you need a fancy domain like myawesomepage.com or something that describes your project. To achieve that you need to first buy a domain and then link that domain to your IP. Domains that are not on high demand typically cost around 10$ to 20$. You can buy them on &lt;a href=&quot;https://www.namecheap.com/&quot; target=&quot;_blank&quot;&gt;Namecheap&lt;/a&gt;. Once you have it you need to do several things on the AWS side. You will need to fix the IP so that it doesn’t change, otherwise the DNS redirection will get broken over time. After that you need to create nameservers and then route your domain to that IP. Let’s go step by step. To fix the IP go to the section Elastic IP in the left bar of the EC2 menu. Create such Elastic IP and then, in actions, associate it to your instance. Once you have done that, you will need to create the hosted zone. For that, search in AWS the Route 53 service. Once there, click on Create hosted zone. Insert your domain and create it. Before we continue, two more records need to be created. Create one with Type A and your previous Elastic IP under the value section, everything else as default. Repeat now but add ‘www’ in subdomain so that your page can be accessed either by its domain or adding www at the beginning. Once you have done that, go to your domain on Namecheap and click on manage. Select custom DNS and enter the four nameservers that were created previously. If you didn’t understand something, you can check the tutorials I followed both for &lt;a href=&quot;https://techgenix.com/namecheap-aws-ec2-linux/&quot; target=&quot;_blank&quot;&gt;the AWS&lt;/a&gt; and &lt;a href=&quot;https://www.namecheap.com/support/knowledgebase/article.aspx/10371/2208/how-do-i-link-my-domain-to-amazon-web-services/&quot; target=&quot;_blank&quot;&gt;Namecheap part&lt;/a&gt;. DNS redirection may take up to 48 hours. There is one last thing to modify, remember that you need to include the IP in &lt;code class=&quot;language-html highlighter-rouge&quot;&gt;ALLOWED_HOSTS&lt;/code&gt;? Well, you also need to include your domain there. Change that and you will have your marvelous webpage running.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Congratulations! You have managed to reach to the end of this tutorial. If you followed the steps carefully you now know how to create your own web apps. The first time you do it is quite tiresome, but once you know how to do it you can get your millionaire idea up and running at the moment. Let’s recap. First, you need to create your Django app. Then, you create a Docker to launch it easily. After that, you create an AWS instance and deploy your app there. Finally, you link your domain to the instance IP. Once you are done you can enjoy your creation!&lt;/p&gt;
</description>
        <pubDate>Wed, 12 Jul 2023 00:00:00 +0000</pubDate>
        <link>https://granadata.art/WebApp-Docker-Django/</link>
        <guid isPermaLink="true">https://granadata.art/WebApp-Docker-Django/</guid>
        
        
        <category>Django</category>
        
        <category>Docker</category>
        
        <category>AWS</category>
        
      </item>
    
      <item>
        <title>Modelling a padel match with Hidden Markov Models (Part 3)</title>
        <description>&lt;p&gt;In &lt;a href=&quot;/HMM-padel&quot; target=&quot;_blank&quot;&gt;part I&lt;/a&gt; and &lt;a href=&quot;/HMM-padel-part2&quot; target=&quot;_blank&quot;&gt;part II&lt;/a&gt; of this series I have talked about what is a Hidden Markov Model, why it is useful for modelling a padel match, and how to design it properly. Today the topic is about testing the model. Testing a machine learning model is the basis for deploying it. Here I will be explaining how to test in python and guide you through our HMM example.&lt;/p&gt;

&lt;h2 id=&quot;pytest&quot;&gt;PyTest&lt;/h2&gt;

&lt;p&gt;Testing in python can be done with several libraries. One of the most popular ones is &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt;. There are many good tutorials out there about how to use it, like &lt;a href=&quot;https://towardsdatascience.com/getting-started-unit-testing-with-pytest-9cba6d366d61&quot; target=&quot;_blank&quot;&gt;this one&lt;/a&gt;. And if you have a project on your hands and have specific needs, you can always go and have a look at &lt;a href=&quot;https://docs.pytest.org/en/6.2.x/contents.html&quot; target=&quot;_blank&quot;&gt;their documentation&lt;/a&gt;. For this post I will pass very briefly on the funcionalities that we need for testing the HMM.&lt;/p&gt;

&lt;p&gt;In pytest you have files that contain the word ‘test’ on it. Those files contain functions that also have the string ‘test’ in their names. And those functions must have code that yields &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;/code&gt; of &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;/code&gt; depending on whether they pass the test. To run the tests you just execute &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; on the command line and the library does the rest of the job for you. This is the big picture, let’s define now what are going to be our tests.&lt;/p&gt;

&lt;p&gt;Our tests are going to have a sequence of observations as input and we are going to check for the result of the match. That is the final goal of the HMM. The difference is that here we are going to deal with simple scenarios where we know for sure the result. That way we can check that the HMM is at least well implemented. We cannot check if the design is going to work in a real-world scenario, but we can check that it works in ideal scenarios. If your model breaks in an environment where you control the input, then something is clearly wrong in the code. However, if it breaks in production it may be that the model hypothesis about the world are wrong. That’s why you need these tests, to detect bugs prior to analysing the correctness of the model itself.&lt;/p&gt;

&lt;p&gt;Once the tests are designed, it’s time to implement them. For that, &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; comes with two main features that make the process easier.&lt;/p&gt;

&lt;h3 id=&quot;parameterization&quot;&gt;Parameterization&lt;/h3&gt;

&lt;p&gt;In &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; you can parameterize the input. When testing a function, several input-output pairs are used to ensure that the function produces the desired result. Using a different file for each input-output pair would be an inconvenience. Instead, you can specify several input-output pairs for a given test. Consider the following test where we are interested in knowing if the HMM correctly detects an ace:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test_ace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;indexer_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Point-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The parameter sequence is a list of observations that corresponds to an ace. Without parameterization we would have to specify a different test function for each sequence that represents an ace. With parameterization we can reuse the function. In &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; that features is implemented with decorators. For those of you who don’t know python enough, a decorator is basically a function of functions. Here it takes the test function as input and creates a parameterized test function as output. Syntactically it is coded like this:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nd&quot;&gt;@pytest.mark.parametrize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;### Ace examples
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test_ace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;indexer_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Point-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You only have to add the decorator on top of the function. If you recall the problem at hands, which sequences could possibly represent an ace? Let’s see some examples:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;### ace in first service ###
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Bounce on wall
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; 
    &lt;span class=&quot;c1&quot;&gt;# Bounce on wall twice
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;### ace in second service ###
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# Bounce on wall
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Bounce on wall twice
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-outer&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically, whenever there are two consecutive bounces on the other side after the first player has hit the ball we have an ace. When an ace happens the server wins, therefore we have to check that the last hidden state correspond to the server winning. If that doesn’t happens, then our HMM isn’t working. Passing this test doesn’t prove that the HMM works, but by adding more and more tests we at least know that our model is robust to all those cases.&lt;/p&gt;

&lt;h3 id=&quot;fixtures&quot;&gt;Fixtures&lt;/h3&gt;

&lt;p&gt;Have you wondered how do you pass parameters to a test? In the previous section I talk about parameterizing with a decorator. But what about the rest of the parameters? Not every parameter is part of the input. There are parameters that are part of the function itself. For instance, the parameter &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;/code&gt;. How does &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; know where to look for that object?&lt;/p&gt;

&lt;p&gt;At the beginning I said that you just have to run &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt; in the command line. You don’t specify parameters to the internal test functions directly. Instead, you use fixtures. A fixture is another decorator provided by &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;pytest&lt;/span&gt;&lt;/code&gt;. In this case, you decorate a function that returns the parameter you want to use later on. Let’s look at an example by specifying the fixture for the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;/code&gt; object. Suppose that you have a function in your code (not your test, your real code) that initialized the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;/code&gt; and returns it. Then, you would convert that function to a fixture this way:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nd&quot;&gt;@pytest.fixture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s everything you have to do in order for every other function to know where to look for the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;/code&gt; object. The same would be needed for the &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;&lt;/code&gt; and &lt;code class=&quot;highlight language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;/code&gt; that in my case are just dictionaries to convert from strings of states to the internal identifiers that the HMM uses.&lt;/p&gt;

&lt;h2 id=&quot;noisy-tests&quot;&gt;Noisy tests&lt;/h2&gt;

&lt;p&gt;To end this post I’ll show you some concrete tests I designed for my HMM. They are a bit different than the rest of the tests. When evaluating the HMM I said that we give ideal scenarios as input to the tests. But it is possible to give noisy scenarios too, if you control the noise. There are no rules for writing tests, they just serve to check that your code does what you want it to do. And if I want my HMM to be robust to noise, I can test for it.&lt;/p&gt;

&lt;p&gt;When I talk about noise in this problem it would be missing some observation or having repeated observations for the same hidden state. We designed our model so that it would work even on those cases. So if I provide a series of noisy observations, it must predict correctly the result. For example, in the following code there is the test for two cases where the server fails on the second service. However, the first hit is repeated and some bounces are repeated too. This series of observations doesn’t correspond to an ideal one, but the model should correctly predict the result.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nd&quot;&gt;@pytest.mark.parametrize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;### Fail in second service ###
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# Bounce in and then on inner wall
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
     &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
     &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
     &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-wall-inner&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;# Bounce out
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test_fail_noise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;indexer_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Point-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also have tests that don’t pass on purpose. I call this one ‘impossible_noise_test’:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; Test designed to make the model fail &lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@pytest.mark.parametrize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Bounces in the ground badly detected as player-hit
&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Badly detected bounce
&lt;/span&gt;    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Well detected serve
&lt;/span&gt;    &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Same bounce 
&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Well detected response
&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;player-hit&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;flying&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Normal rally (now the ball is for receiver)
&lt;/span&gt;     &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;bounce-ground-receiver&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# It goes to net and out
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test_impossible_noise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;indexer_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indexers&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexer_obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obs&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sequences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Point-server&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This type of test allows you to know the limits of the model. There must be a limit, and if you don’t manage to create a test that fails, that is also and indicator that something is wrong. Maybe you are not creative enough for the cases, or you have some bug that makes all the test pass (that has happened to me). So it is also a good idea to have a test that fails, just in case.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;With this post the Hidden Markov Model for Padel Modelling series comes to an end. We have learned everything to deploy a HMM. From the theory behind the model, till testing the model extensively. Those are the steps to put any machine learning model into production. Learning the basics, designing the model and testing the model. The only thing left is to create a pipeline and integrate it into the final product, but that is a topic for another day. I hope you liked the process as much as I did. See you on my next series.&lt;/p&gt;
</description>
        <pubDate>Sun, 16 Oct 2022 00:00:00 +0000</pubDate>
        <link>https://granadata.art/HMM-padel-part3/</link>
        <guid isPermaLink="true">https://granadata.art/HMM-padel-part3/</guid>
        
        
        <category>Hidden Markov Model</category>
        
      </item>
    
  </channel>
</rss>
